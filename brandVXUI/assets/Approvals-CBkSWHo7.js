import{j as e,k as q,l as Y,O as J,C as Q,m as Z,o as ee,r as a}from"./react-vendor--lxKGBiW.js";import{g as p,a as x}from"./index-Bk3Do8do.js";import{B as o}from"./Button-DlSz7573.js";import{s as te}from"./guide-D27LQTJO.js";import{T as I,a as $,b as w,c as n,d as i}from"./Table-CBXGn4MI.js";import{E as se}from"./EmptyState-BVAWAqiR.js";import{S as P}from"./Skeleton-Bpnt4vlv.js";import{P as ae}from"./Pager-CZom1-cd.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";import"./driver-D6Mpyj2M.js";function ne({open:h,title:y="Are you sure?",description:r,confirmText:v="Confirm",cancelText:u="Cancel",onConfirm:m,onOpenChange:l}){return e.jsx(q,{open:h,onOpenChange:l,children:e.jsxs(Y,{children:[e.jsx(J,{className:"fixed inset-0 bg-black/20"}),e.jsxs(Q,{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[min(92vw,420px)] rounded-2xl border border-[var(--border)] bg-white p-6 shadow-soft",children:[e.jsx(Z,{className:"text-lg font-semibold text-ink-900",children:y}),r&&e.jsx(ee,{className:"text-sm text-ink-700 mt-1",children:r}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>l(!1),children:u}),e.jsx(o,{onClick:()=>{m(),l(!1)},children:v})]})]})]})})}function fe(){const[h,y]=a.useState([]),[r,v]=a.useState([]),[u,m]=a.useState(1),l=6,[B,c]=a.useState(""),[k,f]=a.useState(!0),[d,b]=a.useState(null),[D,U]=a.useState(!0),[F,E]=a.useState("all"),[A,z]=a.useState(""),[T,H]=a.useState([]),[N,O]=a.useState("pending"),[g,L]=a.useState("all"),_=async()=>{try{const t=await p(),s=await x.get(`/settings?tenant_id=${encodeURIComponent(t)}`),j=Array.isArray(s?.data?.suggested_campaigns)?s.data.suggested_campaigns:[];H(j)}catch{}},R=async()=>{try{const t=await p();if(!t){z("Sign in to view your To‑Do."),y([]);return}const s=await x.get(`/approvals?tenant_id=${encodeURIComponent(t)}`);y(Array.isArray(s)?s:s.items||[]),c("")}catch{c("Unable to load approvals right now. Please retry.")}},S=async()=>{try{const t=await p(),s=[`status=${encodeURIComponent(N)}`,g&&g!=="all"?`type=${encodeURIComponent(g)}`:""].filter(Boolean).join("&"),j=await x.get(`/todo/list?tenant_id=${encodeURIComponent(t)}${s?"&"+s:""}`);v(Array.isArray(j?.items)?j.items:[])}catch{v([])}};a.useEffect(()=>{(async()=>{try{f(!0),await Promise.all([R(),_(),S()])}finally{f(!1)}})()},[]),a.useEffect(()=>{(async()=>{try{f(!0),await S(),m(1)}finally{f(!1)}})()},[N,g]);const M=async t=>{try{const s=await p(),C=(await x.get(`/settings?tenant_id=${encodeURIComponent(s)}`))?.data||{},X=Array.isArray(C.suggested_campaigns)?C.suggested_campaigns:[],G={...C,suggested_campaigns:X.filter(K=>K?.id!==t)};await x.post("/settings",{tenant_id:s,...G}),await _()}catch(s){c("Update failed: "+String(s?.message||s))}},V=async t=>{try{c("");for(const s of h)await x.post("/approvals/action",{tenant_id:await p(),approval_id:Number(s.id),action:t});await R(),c(`Bulk ${t} completed`)}catch(s){c(String(s?.message||s))}},W=async t=>{try{const s=await p();await x.post("/todo/ack",{tenant_id:s,id:t}),await S()}catch(s){c(String(s?.message||s))}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"To‑Do"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>te("approvals"),children:"Guide me"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{window.location.href="/ask"},children:"AskVX"})]})]}),e.jsx("div",{className:"text-xs text-slate-600",children:"When BrandVX needs your OK for an action, it shows up here. Review the details and Approve or Reject."}),A&&e.jsx("div",{className:"rounded-md border bg-amber-50 text-amber-800 px-2 py-1 text-xs inline-block",children:A}),T.length>0&&e.jsxs("div",{className:"mt-3 rounded-xl border bg-white p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800",children:"Suggested Campaigns (beta)"}),e.jsx("div",{className:"text-xs text-slate-600",children:"Saved from Messages in recommend‑only mode — review or remove."}),e.jsxs(I,{children:[e.jsx($,{children:e.jsxs(w,{children:[e.jsx(n,{children:"When"}),e.jsx(n,{children:"Contact"}),e.jsx(n,{children:"Channel"}),e.jsx(n,{children:"Subject"}),e.jsx(n,{children:"Body"}),e.jsx(n,{children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y",children:T.map(t=>e.jsxs(w,{children:[e.jsx(i,{children:t.created_at?new Date(t.created_at).toLocaleString():""}),e.jsx(i,{children:t.friendly_name||t.display_name||(t.contact_id?"Client":"")}),e.jsx(i,{children:t.channel||""}),e.jsx(i,{children:t.subject||""}),e.jsx(i,{className:"max-w-[22rem] truncate",children:t.body||""}),e.jsx(i,{children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>M(t.id),children:"Remove"})})]},t.id))})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm","data-guide":"filters",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-700",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:t=>U(t.target.checked)})," Show only pending"]}),e.jsxs("select",{className:"text-xs border rounded-md px-2 py-1 bg-white",value:F,onChange:t=>{E(t.target.value),m(1)},"aria-label":"Filter by type",children:[e.jsx("option",{value:"all",children:"All types"}),e.jsx("option",{value:"billing",children:"Billing"}),e.jsx("option",{value:"integration",children:"Integrations"}),e.jsx("option",{value:"reminder",children:"Reminders"}),e.jsx("option",{value:"security",children:"Security"})]})]}),e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-slate-700",children:B}),!k&&h.length>0&&e.jsxs("div",{className:"flex gap-2","data-guide":"actions",children:[e.jsx(o,{variant:"outline",onClick:()=>b("approve"),children:"Approve All"}),e.jsx(o,{variant:"outline",onClick:()=>b("reject"),children:"Reject All"})]}),e.jsx(ne,{open:!!d,onOpenChange:t=>b(t?d:null),title:d==="approve"?"Approve all pending items?":"Reject all pending items?",description:`This will ${d||""} ${h.length} item(s). You can’t undo this action.`,confirmText:d==="approve"?"Approve all":"Reject all",onConfirm:()=>d&&V(d)}),k?e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"h-10"}),e.jsx(P,{className:"h-32"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("div",{className:"inline-flex rounded-full bg-white overflow-hidden border",children:["pending","all"].map(t=>e.jsx("button",{className:`px-3 py-1 ${N===t?"bg-slate-900 text-white":"text-slate-700"}`,onClick:()=>O(t),children:t},t))}),e.jsxs("select",{className:"text-xs border rounded-md px-2 py-1 bg-white",value:g,onChange:t=>L(t.target.value),"aria-label":"Filter by type",children:[e.jsx("option",{value:"all",children:"All types"}),e.jsx("option",{value:"approval",children:"Approval"}),e.jsx("option",{value:"followup",children:"Follow‑up"}),e.jsx("option",{value:"import",children:"Import"}),e.jsx("option",{value:"calendar",children:"Calendar"}),e.jsx("option",{value:"billing",children:"Billing"})]})]}),r.length===0?e.jsx("div",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:e.jsx(se,{title:"Nothing pending",description:"When VX needs your OK, items will appear here."})}):e.jsxs(e.Fragment,{children:[e.jsxs(I,{"data-guide":"table",children:[e.jsx($,{children:e.jsxs(w,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Title"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:r.slice((u-1)*l,u*l).map(t=>e.jsxs(w,{children:[e.jsx(i,{children:t.id}),e.jsx(i,{children:t.type}),e.jsx(i,{className:"truncate max-w-[16rem]",children:e.jsx("span",{title:t.title,children:t.title})}),e.jsx(i,{children:t.created_at?new Date(t.created_at).toLocaleString():""}),e.jsx(i,{children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>W(Number(t.id)),children:"Mark done"})})]},t.id))})]}),e.jsx(ae,{page:u,pageSize:l,total:r.length,onPrev:()=>m(t=>Math.max(1,t-1)),onNext:()=>m(t=>t*l<r.length?t+1:t)})]})]})]})}export{fe as default};
