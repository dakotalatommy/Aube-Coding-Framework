import{r as a,j as e}from"./react-vendor--lxKGBiW.js";import{g as d,a as r}from"./index-Bk3Do8do.js";import{s as ie}from"./guide-D27LQTJO.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";import"./driver-D6Mpyj2M.js";function ye(){const[u,P]=a.useState([]),[S,C]=a.useState([]),[W,g]=a.useState(!1),[k,b]=a.useState(""),[H,Q]=a.useState(!0),[R,V]=a.useState(""),[T,X]=a.useState(""),[de,I]=a.useState(!1),[i,E]=a.useState("all"),[o,J]=a.useState(""),[j,K]=a.useState(""),[y,Y]=a.useState(""),[c,_]=a.useState({}),[$,A]=a.useState({}),[l,f]=a.useState(null),[m,L]=a.useState([]),[v,G]=a.useState(""),[U,O]=a.useState(""),[x,h]=a.useState(""),[Z,F]=a.useState(!1),[D,N]=a.useState(""),[ee,w]=a.useState(!1),se={email:["Thanks for your note — attaching details and a link to schedule. Happy to help!","We have availability this Friday and next Tuesday. Would either work?","Appreciate you! Here’s a quick overview and next steps."]},B=async()=>{try{const s=await d(),t=await r.get(`/inbox/list?tenant_id=${encodeURIComponent(s)}`);P(t?.items||[])}catch(s){V(String(s?.message||s))}finally{Q(!1)}};a.useEffect(()=>{(async()=>await B())()},[]),a.useEffect(()=>{try{const s=new URLSearchParams(window.location.search);s.get("error")&&X(s.get("error")||"")}catch{}},[]),a.useEffect(()=>{(async()=>{try{const s=await d(),t=await r.post("/onboarding/analyze",{tenant_id:s});if(I(!!t?.summary?.inbox_ready),t?.summary?.connected&&_(t.summary.connected),(t?.summary?.connected||{}).google==="connected"){g(!0);try{const n=await r.get(`/gmail/threads?tenant_id=${encodeURIComponent(s)}&q=${encodeURIComponent(o)}&limit=20`);C(Array.isArray(n?.items)?n.items:[])}catch(n){b(String(n?.message||n))}finally{g(!1)}}}catch{}})()},[]);const te=async s=>{A(n=>({...n,[s]:!0}));const t=!1;try{if(!t){const n=await r.get(`/oauth/${s}/login?tenant_id=${encodeURIComponent(await d())}`);n?.url&&window.open(n.url,"_blank")}}finally{A(n=>({...n,[s]:!1}))}},ae=async()=>{try{const s=await r.post("/onboarding/analyze",{tenant_id:await d()});I(!!s?.summary?.inbox_ready),s?.summary?.connected&&_(s.summary.connected)}catch{}};if(H)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 w-40 bg-slate-200 rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-full bg-slate-200 rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-full bg-slate-200 rounded animate-pulse"}),e.jsx("div",{className:"h-48 w-full bg-slate-200 rounded animate-pulse"})]});if(R)return e.jsxs("div",{style:{color:"#b91c1c"},children:["Error: ",R]});const M=i==="all"?u:u.filter(s=>(s.channel||"").toLowerCase()===i),q=o?M.filter(s=>[s.channel,s.from,s.to,s.preview].join(" ").toLowerCase().includes(o.toLowerCase())):M,z=j||y?q.filter(s=>{const t=Number(s.ts||0)*1e3;if(j){const n=new Date(j+"T00:00:00").getTime();if(t<n)return!1}if(y){const n=new Date(y+"T23:59:59").getTime();if(t>n)return!1}return!0}):q,ne=i==="all"?"inbox":i,le={all:u.length,email:u.filter(s=>(s.channel||"").toLowerCase()==="email").length};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Inbox"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-sm text-slate-600 hover:underline","aria-label":"Open inbox guide",onClick:()=>ie("inbox"),children:"Guide me"}),e.jsx("button",{className:"px-2 py-1 rounded-md border bg-white hover:shadow-sm text-sm",onClick:()=>{window.location.href="/ask"},children:"AskVX"})]})]}),c.google!=="connected"&&e.jsxs("div",{className:"rounded-md border bg-white p-3 shadow-sm flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("div",{className:"text-slate-700",children:"Connect Gmail to see your threads and reply in BrandVX."}),e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white hover:shadow-sm text-sm disabled:opacity-50",disabled:!!$.google,onClick:()=>te("google"),children:$.google?"Connecting…":"Connect Gmail"})]}),T&&e.jsxs("div",{className:"text-xs text-rose-700 bg-rose-50 border border-rose-100 rounded-md px-2 py-1 inline-block",children:["OAuth error: ",T]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs","data-guide":"channels",children:["all","email"].map(s=>e.jsxs("button",{className:`px-2 py-1 rounded-full border ${i===s?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 hover:shadow-sm"}`,onClick:()=>E(s),children:[s," · ",le[s]]},s))}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-slate-700",children:Object.entries(c).map(([s,t])=>e.jsxs("span",{className:`px-2 py-1 rounded-md border bg-white ${t==="connected"?"border-emerald-200 text-emerald-700":t==="pending_config"?"border-amber-200 text-amber-700":"border-slate-200"}`,children:[s,": ",t]},s))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm","data-guide":"filters",children:[e.jsx("span",{className:"text-slate-600",children:"Filter:"}),e.jsxs("select",{className:"border rounded-md px-2 py-1 bg-white",value:i,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"instagram",children:"Instagram"}),e.jsx("option",{value:"sms",children:"SMS"}),e.jsx("option",{value:"email",children:"Email"})]}),e.jsx("input",{className:"border rounded-md px-2 py-1 bg-white",placeholder:"Search…",value:o,onChange:s=>J(s.target.value),"data-guide":"search"}),e.jsx("input",{className:"border rounded-md px-2 py-1 bg-white",type:"date",value:j,onChange:s=>K(s.target.value),"data-guide":"date-from"}),e.jsx("input",{className:"border rounded-md px-2 py-1 bg-white",type:"date",value:y,onChange:s=>Y(s.target.value),"data-guide":"date-to"}),e.jsx("button",{className:"px-2 py-1 rounded-md border bg-white hover:shadow-sm",onClick:B,children:"Refresh messages"}),e.jsx("button",{className:"ml-auto px-2 py-1 rounded-md border bg-white hover:shadow-sm",onClick:ae,children:"Refresh status"})]}),e.jsx("div",{className:"rounded-xl border bg-white p-3 shadow-sm text-sm text-slate-700","aria-live":"polite",children:"Email inbox: connect Gmail above to view and reply to threads."}),Object.entries(c).filter(([s])=>s==="google").some(([,s])=>s==="pending_config")&&e.jsx("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-100 rounded-md px-2 py-1 inline-block",children:"Some connections are pending configuration. Complete app credentials to activate."}),c.google==="connected"&&e.jsxs("section",{className:"rounded-2xl border bg-white p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800",children:"Gmail"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded-md border bg-white hover:shadow-sm",onClick:async()=>{g(!0),b("");try{const s=await d(),t=await r.get(`/gmail/threads?tenant_id=${encodeURIComponent(s)}&q=${encodeURIComponent(o)}&limit=20`);C(Array.isArray(t?.items)?t.items:[])}catch(s){b(String(s?.message||s))}finally{g(!1)}},children:"Refresh"})]}),k&&e.jsx("div",{className:"text-xs text-rose-700 bg-rose-50 border border-rose-100 rounded-md px-2 py-1 inline-block",children:k}),W?e.jsx("div",{className:"text-sm text-slate-600",children:"Loading…"}):S.length===0?e.jsx("div",{className:"text-sm text-slate-600",children:"No Gmail threads yet."}):e.jsx("div",{className:"rounded-xl border bg-white overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Subject"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"From"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"To"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Snippet"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Time"})]})}),e.jsx("tbody",{className:"divide-y",children:S.map((s,t)=>e.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onClick:async()=>{try{const n=await d(),p=await r.get(`/gmail/thread?tenant_id=${encodeURIComponent(n)}&id=${encodeURIComponent(s.id)}`);f({channel:"email",from:s.from,to:s.to,preview:s.subject||s.snippet,ts:s.ts});const re=Array.isArray(p?.messages)?p.messages:[];L(re),G((s.from||"").toString()),O(s.subject?`Re: ${s.subject}`:"Re:"),h(""),w(!1),N("")}catch(n){b(String(n?.message||n))}},children:[e.jsx("td",{className:"px-3 py-2",children:s.subject||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.from||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.to||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.snippet||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.ts?new Date(s.ts*1e3).toLocaleString():""})]},t))})]})})]}),z.length===0?e.jsxs("div",{className:"rounded-xl border bg-white p-3 shadow-sm text-sm text-slate-600",children:["No ",ne," messages yet.",e.jsxs("div",{className:"block text-xs text-slate-500 mt-1 space-y-2",children:[i==="email"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Connect Email provider (SendGrid) in Integrations to receive emails."}),e.jsx("a",{href:"/workspace?pane=integrations",className:"px-2 py-1 rounded-md border bg-white hover:shadow-sm text-xs",children:"Open Integrations"})]}),i==="all"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Once Gmail is connected, your email threads will appear here."}),e.jsx("a",{href:"/workspace?pane=integrations",className:"px-2 py-1 rounded-md border bg-white hover:shadow-sm text-xs",children:"Connect providers"})]})]})]}):e.jsx("div",{className:"rounded-xl border bg-white p-0 shadow-sm overflow-hidden","data-guide":"table",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Channel"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"From"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"To"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Preview"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Time"})]})}),e.jsx("tbody",{className:"divide-y",children:z.map((s,t)=>e.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onClick:()=>f(s),children:[e.jsx("td",{className:"px-3 py-2",children:s.channel||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.from||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.to||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.preview||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.ts?new Date(s.ts*1e3).toLocaleString():""})]},t))})]})}),l&&e.jsxs("div",{className:"fixed inset-0 z-40",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20",onClick:()=>f(null)}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl border-l p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-ink-900",children:"Message"}),e.jsx("button",{className:"text-slate-600 hover:text-slate-800",onClick:()=>f(null),children:"Close"})]}),e.jsxs("div",{className:"text-sm text-slate-700 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Channel:"})," ",l.channel||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"From:"})," ",l.from||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"To:"})," ",l.to||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Time:"})," ",l.ts?new Date(l.ts*1e3).toLocaleString():"—"]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-slate-500 block",children:"Preview:"}),e.jsx("div",{className:"mt-1 rounded-md border bg-slate-50 p-2 text-slate-800",children:l.preview||"—"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Quick replies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(se[l.channel||"all"]||[]).map(s=>e.jsx("button",{className:"px-2 py-1 rounded-full border bg-white text-xs hover:shadow-sm",onClick:()=>h((x?x+`

`:"")+s),children:s},s))})]}),c.google==="connected"&&l.channel==="email"&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"font-medium text-slate-900",children:"Thread"}),e.jsx("div",{className:"max-h-48 overflow-auto border rounded-md bg-slate-50 p-2",children:e.jsxs("ul",{className:"space-y-2",children:[m.map((s,t)=>e.jsxs("li",{className:"text-xs",children:[e.jsxs("div",{className:"text-slate-500",children:[s.date||""," · ",s.from||""," → ",s.to||""]}),e.jsx("div",{className:"text-slate-800",children:s.snippet||""})]},t)),m.length===0&&e.jsx("li",{className:"text-xs text-slate-500",children:"No messages yet."})]})}),e.jsx("div",{className:"font-medium text-slate-900",children:"Reply"}),D&&e.jsx("div",{className:"text-xs text-rose-700 bg-rose-50 border border-rose-100 rounded-md px-2 py-1 inline-block",children:D}),ee&&e.jsx("div",{className:"text-xs text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-md px-2 py-1 inline-block",children:"Sent."}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:"border rounded-md px-2 py-1 bg-white",placeholder:"To",value:v,onChange:s=>G(s.target.value)}),e.jsx("input",{className:"border rounded-md px-2 py-1 bg-white",placeholder:"Subject",value:U,onChange:s=>O(s.target.value)}),e.jsx("textarea",{className:"border rounded-md px-2 py-2 bg-white min-h-[96px]",placeholder:"Write your reply…",value:x,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md bg-slate-900 text-white disabled:opacity-50",disabled:Z||!v||!x,onClick:async()=>{F(!0),N(""),w(!1);try{const s=await d(),t=m[m.length-1]?.threadId||"",n=await r.post("/gmail/send",{tenant_id:s,to:v,subject:U||"Re:",body_html:x,threadId:t});if(n?.status!=="sent")throw new Error(n?.error||"Failed to send");if(w(!0),h(""),t){const p=await r.get(`/gmail/thread?tenant_id=${encodeURIComponent(s)}&id=${encodeURIComponent(t)}`);L(Array.isArray(p?.messages)?p.messages:m)}}catch(s){N(String(s?.message||s))}finally{F(!1)}},children:"Send"}),e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white",onClick:()=>{h(""),N(""),w(!1)},children:"Clear"})]})]})]})]})]})]})]})}export{ye as default};
