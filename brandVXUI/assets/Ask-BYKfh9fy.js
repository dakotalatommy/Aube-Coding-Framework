import{r as s,j as t}from"./react-vendor--lxKGBiW.js";import{u as Dt,a as x,g as k,t as tt,b as rt}from"./index-Bk3Do8do.js";import{s as Qt}from"./guide-D27LQTJO.js";import{m as jt}from"./motion-37lkt-10.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";import"./driver-D6Mpyj2M.js";const T=new Intl.NumberFormat("en-US"),Zt=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}),te=i=>{const p=Number(i||0)/100;return Zt.format(p||0)},ee=i=>{const{snapshot:p,planDays:l,brandProfile:u,goals:b,importSummary:c}=i,g=Number(p?.horizon_days||90),I=Number(c?.imported||0),R=Number(c?.updated||0),X=I+R,h=String(c?.provider||"").toUpperCase(),r=[];return r.push("# BrandVX 14-Day Strategy"),r.push(""),r.push(`Generated: ${new Date().toLocaleDateString()}`),r.push(""),r.push("## Snapshot"),r.push(`- Revenue (last ${g} days): ${te(p?.revenue_cents)} (±$100)`),r.push(`- Contacts synced: ${T.format(X)}${h?` via ${h}`:""}`),u?.voice&&r.push(`- Brand voice: ${u.voice}`),u?.about&&r.push(`- Brand profile: ${u.about}`),b?.primary&&r.push(`- Primary goal: ${b.primary}`),r.push(""),r.push("## Top Clients"),r.push("- Revisit your top clients with thank-you outreach this week."),r.push(""),r.push("## Day-by-day plan"),l.length?l.forEach(y=>{r.push(`### Day ${y.day_index}`),(Array.isArray(y.tasks)&&y.tasks.length?y.tasks:["Focus on client outreach and content."]).forEach(L=>{r.push(`- ${L}`)}),r.push("")}):r.push("- Strategy plan not generated yet. Run the AskVX snapshot first."),r.push("## Next steps"),r.push("- Send the thank-you drafts above to keep your champions engaged."),r.push("- Ask VX for daily guidance: “What should I tackle today from my 14-day plan?”"),r.push("- Update Train VX with new brand facts after each big win."),r.join(`
`)},Mt=(i,p)=>{const l=String(i||"").split(`
`);return l.length<=p?l.join(`
`):[...l.slice(0,p),"…"].join(`
`)},se=()=>{try{const i=[],p=Array.isArray(window.__bvxMemories)?window.__bvxMemories.slice(0,5):[];if(p.length){const u=p.map(b=>{const c=String(b?.key||"").trim(),g=b?.value,I=typeof g=="string"?Mt(g,4):JSON.stringify(g);return`- ${c||"memory"}: ${I}`});i.push(`Recent brand memory:
${u.join(`
`)}`)}const l=window.__bvxStrategyDoc?.markdown;return l&&i.push(`Current 14-day strategy draft:
${Mt(String(l),40)}`),i.length?`${i.join(`

`)}

`:""}catch{return""}};function ge(){const{showToast:i}=Dt(),[p,l]=s.useState(""),[u,b]=s.useState([]),c=s.useRef(u);s.useEffect(()=>{c.current=u},[u]);const[g,I]=s.useState(!1),[R,X]=s.useState(!1),h=s.useRef(null),[r,y]=s.useState(null),[B,L]=s.useState(!1),[O,M]=s.useState(null),[_,H]=s.useState(null),[$,ot]=s.useState(()=>localStorage.getItem("bvx_first_prompt_note")==="1"),[J,it]=s.useState(""),[d,v]=s.useState(""),[w,q]=s.useState(()=>{try{return window.__bvxLastImport||null}catch{return null}}),[S,U]=s.useState(()=>{try{return!!window.__bvxSkipImport}catch{return!1}}),[C,G]=s.useState(!1),[W,z]=s.useState(""),[N,ct]=s.useState(""),[Vt,ht]=s.useState(!1),[gt,_t]=s.useState(""),[Ct,Et]=s.useState(!1),[xt,It]=s.useState(""),[Ft,Rt]=s.useState(!1),[yt]=s.useState(()=>{try{return(new URLSearchParams(window.location.search).get("mode")||"").toLowerCase()}catch{return""}}),[Y]=s.useState(()=>{const e="bvx_chat_session",a=localStorage.getItem(e);if(a)return a;const n="s_"+Math.random().toString(36).slice(2,10);return localStorage.setItem(e,n),n}),P=(()=>{try{return new URLSearchParams(window.location.search).get("onboard")==="1"}catch{return!1}})(),Q=String(u.filter(e=>e.role==="assistant").slice(-1)[0]?.content||""),dt=s.useRef(null);s.useEffect(()=>{try{dt.current?.focus()}catch{}},[]),s.useEffect(()=>{(async()=>{try{const e=Number(localStorage.getItem("bvx_last_digest_since")||"0"),a=await x.get(`/ai/digest?tenant_id=${encodeURIComponent(await k())}&since=${encodeURIComponent(String(e||0))}`);H(a?.digest||null),localStorage.setItem("bvx_last_digest_since",String(Date.now()/1e3|0))}catch{}})()},[]),s.useEffect(()=>{const e=a=>{try{const n=a.detail||{};q(n);const o=!!n?.error;U(o);try{window.__bvxSkipImport=o}catch{}}catch{}};return window.addEventListener("bvx:flow:contacts-imported",e),()=>window.removeEventListener("bvx:flow:contacts-imported",e)},[]),s.useEffect(()=>{const e=()=>{U(!0);try{window.__bvxSkipImport=!0}catch{}};return window.addEventListener("bvx:onboarding:skip-import",e),()=>window.removeEventListener("bvx:onboarding:skip-import",e)},[]),s.useEffect(()=>()=>{if(N)try{URL.revokeObjectURL(N)}catch{}},[N]);const ft=s.useCallback(async(e,a)=>{const n=e.trim();if(!n||g)return{text:"",error:"empty"};try{tt("ask.prompt_submitted",{onboard:P,length:n.length})}catch{}const o=a?.hidden?`

${a.hidden.trim()}`:"",K=`${P?se():""}${n}${o}`,mt=[...c.current,{role:"user",content:K}];b(mt),l(""),I(!0);try{const j=(()=>{try{return new URLSearchParams(window.location.search).get("onboard")==="1"}catch{return!1}})(),D=performance.now(),nt=a?.mode??(j?"onboard":yt||void 0);try{window.dispatchEvent(new CustomEvent("bvx:flow:askvx-user",{detail:{prompt:K,context:a?.context||{}}}))}catch{}const E=await x.post("/ai/chat/raw",{tenant_id:await k(),messages:mt,session_id:Y,mode:nt},{timeoutMs:6e4});if(E?.error){const F=`Error: ${String(E.detail||E.error)}`;b(kt=>[...kt,{role:"assistant",content:F}]);try{window.dispatchEvent(new CustomEvent("bvx:flow:askvx-response",{detail:{prompt:K,error:F,context:a?.context||{}}}))}catch{}try{tt("ask.response_error",{onboard:j,error:F.slice(0,120)})}catch{}return I(!1),{text:"",error:F}}const V=String(E?.text||"");$||(ot(!0),localStorage.setItem("bvx_first_prompt_note","1"));try{tt("ask.response_stream_start",{onboard:j,chars:V.length})}catch{}X(!0),b(F=>[...F,{role:"assistant",content:""}]);const Yt=Math.max(2,Math.floor(V.length/200));let ut=0;return h.current&&(window.clearInterval(h.current),h.current=null),h.current=window.setInterval(()=>{ut=Math.min(V.length,ut+Yt);const F=V.slice(0,ut);if(b(kt=>{const pt=kt.slice(),Nt=pt.length-1;return Nt>=0&&pt[Nt].role==="assistant"&&(pt[Nt]={role:"assistant",content:F}),pt}),ut>=V.length){h.current&&(window.clearInterval(h.current),h.current=null),X(!1);try{window.dispatchEvent(new CustomEvent("bvx:flow:askvx-response",{detail:{prompt:K,text:V,context:a?.context||{}}}))}catch{}try{tt("ask.response_stream_complete",{onboard:j,chars:V.length,duration_ms:Math.max(0,Math.round(performance.now()-D))})}catch{}}},20),{text:V,error:""}}catch(j){const D=String(j?.message||j);try{tt("ask.response_error",{onboard:P,error:D.slice(0,120)})}catch{}b(nt=>[...nt,{role:"assistant",content:D}]);try{window.dispatchEvent(new CustomEvent("bvx:flow:askvx-response",{detail:{prompt:K,error:D,context:a?.context||{}}}))}catch{}return{text:"",error:D}}finally{I(!1)}},[g,yt,Y,$,P]),Z=async()=>{const e=p.trim();if(!e||g)return;const a={};if(P&&(a.mode="onboard"),J&&(a.context={onboardingInsights:J},a.hidden="You are AskVX guiding onboarding. Do not ask clarifying questions. Answer first, list the revenue summary, highlight top clients using full names, and suggest exactly one next action."),d){a.context={...a.context||{},onboardingStrategy:d};const m="Provide the 14-day strategy immediately without asking clarifying questions. Keep tone warm and confident; use full client names.";a.hidden=a.hidden?`${a.hidden}
${m}`:m}const n=Object.keys(a).length?a:void 0,o=await ft(e,n);if(J){it("");try{window.dispatchEvent(new CustomEvent("bvx:onboarding:askvx-sent",{detail:{success:!o?.error}}))}catch{}}if(d){if(!o?.error){await At();try{window.dispatchEvent(new CustomEvent("bvx:onboarding:strategy-ready",{detail:{success:!0}}))}catch{}}v("")}};s.useEffect(()=>{try{const e=Q.toLowerCase();if(!e){y(null);return}if(e.includes("import")&&e.includes("contact")){y({label:"Import contacts from Square",tool:"contacts.import.square",params:{}});return}if(e.includes("sync")&&e.includes("calendar")){y({label:"Sync calendar",tool:"calendar.sync",params:{provider:"auto"}});return}if(e.includes("send")&&(e.includes("sms")||e.includes("text"))){y({label:"Send a test SMS",tool:"messages.send",params:{contact_id:"c_demo",channel:"sms",body:"Hi from brandVX (demo)"}});return}y(null)}catch{y(null)}},[Q]),s.useEffect(()=>{(async()=>{try{if(!(new URLSearchParams(window.location.search).get("onboard")==="1"))return;const n=await k();await x.post("/ai/chat/raw",{tenant_id:n,session_id:Y,messages:[{role:"user",content:"Context: Use best estimates from tenant data. Avoid more than two clarifying questions; if uncertain, compute a conservative estimate and state assumptions briefly."}]})}catch{}})()},[]);const Xt=async()=>{if(!(!r||B))try{L(!0),M({status:"running"});const e=await x.post("/ai/tools/execute",{tenant_id:await k(),name:r.tool,params:{tenant_id:await k(),...r.params||{}},require_approval:!1,mode:yt||void 0});M(e||{status:"ok"});try{i({title:"Action executed",description:r.label})}catch{}try{tt("ask.smart_action.run",{tool:r.tool})}catch{}}catch(e){M({status:"error",detail:String(e?.message||e)});try{i({title:"Action failed",description:String(e?.message||e)})}catch{}}finally{L(!1)}},$t=s.useCallback(async()=>{try{const e=await k(),a=await x.post("/onboarding/askvx/insights",{tenant_id:e,horizon_days:90},{timeoutMs:45e3});if(!a||a.status!=="ok")throw new Error(String(a?.detail||"Unable to generate snapshot"));const n=a?.data||{};try{window.__bvxAskInsights={summary:n}}catch{}i({title:"Snapshot ready",description:"AskVX can pull from it on demand."})}catch(e){const a=String(e?.message||e);i({title:"Snapshot failed",description:a})}finally{}},[i]),Pt=s.useCallback(async()=>{try{const e=await k();await x.get(`/settings?tenant_id=${encodeURIComponent(e)}`)}catch{}},[]);s.useEffect(()=>{const e=a=>{try{const n=a.detail||{},o=String(n.kind||"").toLowerCase();if(!o)return;if(rt("askvx_prefill",{kind:o,source:n.source||"tour"}),o==="insights"){const m=String(n.prompt||n.visible||"");it(m),l(m)}if(o==="strategy"){const m=String(n.prompt||n.visible||"");v(m),l(m)}try{dt.current?.focus()}catch{}}catch{}};return window.addEventListener("bvx:ask:prefill",e),()=>window.removeEventListener("bvx:ask:prefill",e)},[]),s.useEffect(()=>{const e=a=>{try{const n=a.detail||{},o=String(n.action||"").toLowerCase();if(!o)return;if(rt("askvx_flow_command",{action:o}),o==="askvx.send"){const m=String(n.prompt||p).trim();if(!m)return;ft(m,{mode:n.mode,context:n.context,hidden:n.hidden})}if(o==="askvx.tab"){const m=String(n.tab||"chat").toLowerCase();at(m==="profile"?1:0)}(o==="askvx.run-insights"||o==="askvx.frontfill-insights")&&$t(),o==="askvx.frontfill-strategy"&&Pt()}catch{}};return window.addEventListener("bvx:flow:askvx-command",e),()=>window.removeEventListener("bvx:flow:askvx-command",e)},[$t,Pt,p,ft]);const At=s.useCallback(async()=>{if(!C)try{G(!0);const e=await k(),a=(()=>{const E=window.__bvxAskInsights?.summary;return E||null})()||{};try{await x.post("/plan/14day/generate",{tenant_id:e,step_key:"onboarding"})}catch(E){console.warn("plan generation warning",E)}const n=await x.get(`/plan/14day/all?tenant_id=${encodeURIComponent(e)}`),o=Array.isArray(n?.days)?n.days:[],m=await x.get(`/settings?tenant_id=${encodeURIComponent(e)}`),K=m?.data?.brand_profile||{},mt=m?.data?.goals||{},j=ee({snapshot:a,planDays:o,brandProfile:K,goals:mt,importSummary:w});if(N)try{URL.revokeObjectURL(N)}catch{}const D=new Blob([j],{type:"text/markdown;charset=utf-8;"}),nt=URL.createObjectURL(D);z(j),ct(nt),ht(!1);try{await x.post("/onboarding/strategy/document",{tenant_id:e,markdown:j,tags:["plan","14day","onboarding"]}),ht(!0);try{localStorage.setItem("bvx_done_plan","1")}catch{}}catch(E){console.error("strategy document save failed",E)}try{window.__bvxStrategyDoc={markdown:j,planDays:o,snapshot:a}}catch{}try{window.dispatchEvent(new CustomEvent("bvx:onboarding:strategy-ready",{detail:{saved:!0}}))}catch{}i({title:"Strategy ready",description:"Download your 14-day plan below."})}catch(e){const a=String(e?.message||e);if(N)try{URL.revokeObjectURL(N)}catch{}ct(""),z(""),ht(!1),i({title:"Strategy error",description:a})}finally{G(!1)}},[C,J,i,N,w]),Bt=e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault(),Z();return}e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),Z())},Ot=()=>{b([]),l("")},qt=async()=>{try{if(!gt.trim()){i({title:"Nothing to save",description:"Add a note first."});return}Et(!0);const e=await k(),a=await x.get(`/settings?tenant_id=${encodeURIComponent(e)}`),n=String(a?.data?.training_notes||""),o=(n?n+`
`:"")+gt.trim();await x.post("/settings",{tenant_id:e,training_notes:o}),_t(""),i({title:"Saved",description:"Added to brand training notes."});try{rt("brand_trainer_saved")}catch{}try{window.dispatchEvent(new CustomEvent("bvx:onboarding:trainvx-saved",{detail:{length:o.length}}))}catch{}}catch(e){i({title:"Save error",description:String(e?.message||e)})}finally{Et(!1)}},Gt=async()=>{try{if(Ft)return;Rt(!0);const e=await k(),a="Summarize this chat session for a beauty professional in 4 short bullets: focus on wins, next steps, and any data insights. Keep proper nouns. Avoid sensitive data.",n=u.length>0?[...u,{role:"user",content:a}]:[{role:"user",content:a}],o=await x.post("/ai/chat/raw",{tenant_id:e,session_id:Y,messages:n},{timeoutMs:45e3}),m=String(o?.text||"");if(!m){i({title:"No summary",description:"The model did not return text."});return}It(m);try{await x.post("/ai/chat/session/summary",{tenant_id:e,session_id:Y,summary:m})}catch{}try{rt("ask_session_summarized")}catch{}}catch(e){i({title:"Summary error",description:String(e?.message||e)})}finally{Rt(!1)}};s.useEffect(()=>()=>{h.current&&(window.clearInterval(h.current),h.current=null)},[]),s.useEffect(()=>{P||(async()=>{try{await Gt()}catch{}})()},[P]);const Lt=Number(w?.imported||0),Ut=Number(w?.updated||0),bt=Lt+Ut,lt=String(w?.provider||"").toUpperCase(),et=String(w?.error||""),Wt=S?"Import skipped":bt>0?`${T.format(bt)} contacts ready`:"Contacts ready",zt=S?"We’ll focus on strategy without importing contacts.":bt>0?`${T.format(Lt)} new • ${T.format(Ut)} updated${lt?` · ${lt}`:""}`:lt?`${lt} connected — run insights to review.`:"Import from booking to populate askVX insights.",A={contactsAdded:Number(_?.contacts_added||0),contactsUpdated:Number(_?.contacts_updated||0),appointments:Number(_?.appointments||0),messagesSent:Number(_?.messages_sent||0),syncEvents:Number(_?.sync_events||0)},Kt=!_||A.contactsAdded===0&&A.contactsUpdated===0&&A.appointments===0&&A.messagesSent===0&&A.syncEvents===0,Tt=[],Ht=xt||(P?"Last session summary will appear on your next login.":"—"),vt=new URLSearchParams(typeof window<"u"?window.location.search:""),st=vt.get("embed")==="1",wt=vt.get("demo")==="1",Jt=vt.get("page")==="2"?1:0,[f,at]=s.useState(Jt),St=s.useRef(null);return s.useEffect(()=>{try{St.current?.scrollTo({top:St.current.scrollHeight,behavior:"smooth"})}catch{}},[u.length,R,g]),s.useEffect(()=>{try{new URLSearchParams(window.location.search).get("tour")==="1"&&Qt("askvx")}catch{}},[]),s.useEffect(()=>{try{window.dispatchEvent(new CustomEvent("bvx:onboarding:askvx-tab-active",{detail:{index:f}}))}catch{}},[f]),s.useEffect(()=>{let e=!1;const a=()=>{if(!e){try{const n=document.querySelector('[data-guide="ask-input"]')||dt.current;if(n){const o=n.getBoundingClientRect?.();if(o&&o.width>0&&o.height>0){try{window.dispatchEvent(new CustomEvent("bvx:ask:ready"))}catch{}try{window.dispatchEvent(new CustomEvent("bvx:dbg",{detail:{type:"ready",pane:"askvx"}}))}catch{}return}}}catch{}setTimeout(()=>{try{requestAnimationFrame(a)}catch{a()}},60)}};try{requestAnimationFrame(()=>{requestAnimationFrame(a)})}catch{setTimeout(a,60)}return()=>{e=!0}},[]),t.jsxs("div",{className:"h-full min-h-0 flex flex-col min-w-0 overflow-x-hidden overflow-y-hidden pb-3",children:[wt&&t.jsx("div",{className:"rounded-2xl p-3 border bg-amber-50/80 border-amber-200 text-amber-900",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:"Demo mode — chat replies are simulated."}),t.jsx("a",{href:"/signup",className:"px-3 py-1.5 rounded-full bg-slate-900 text-white text-sm",children:"Create account"}),t.jsx("a",{href:"/billing",className:"px-3 py-1.5 rounded-full border bg-white text-sm",children:"Add payment"})]})}),!st&&t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsx("h3",{className:"text-xl font-semibold text-slate-900","data-guide":"askvx-heading",style:{fontFamily:"var(--font-display)"},children:"AskVX"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"inline-flex rounded-full bg-white overflow-hidden shadow-sm",children:[t.jsx("button",{className:`px-3 py-1 text-sm ${f===0?"bg-slate-900 text-white":"text-slate-700"}`,onClick:()=>at(0),children:"Chat"}),t.jsx("button",{className:`px-3 py-1 text-sm ${f===1?"bg-slate-900 text-white":"text-slate-700"}`,onClick:()=>at(1),children:"Train & Profile"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[t.jsx("button",{className:"px-2 py-1 text-xs border rounded-md bg-white",onClick:()=>at(e=>Math.max(0,e-1)),disabled:f===0,children:"Prev"}),t.jsx("button",{className:"px-2 py-1 text-xs border rounded-md bg-white",onClick:()=>at(e=>Math.min(1,e+1)),disabled:f===1,children:"Next"})]})]})]}),f===0&&t.jsxs("div",{className:"mt-3 grid gap-2 md:grid-cols-[minmax(0,1fr)_minmax(0,2fr)]",children:[t.jsxs("div",{className:`rounded-xl border ${S||et?"border-amber-200 bg-amber-50 text-amber-900":"border-sky-200 bg-sky-50 text-slate-900"} p-3 shadow-sm`,"data-guide":"askvx-import-count",children:[t.jsx("div",{className:"text-sm font-semibold",children:Wt}),t.jsx("div",{className:"mt-1 text-sm text-slate-700",children:et||zt}),!S&&!et&&Tt.length>0&&t.jsxs("div",{className:"mt-2 text-[11px] text-slate-500",children:["Top contacts spotted: ",Tt.map(e=>e.name).join(", ")]})]}),t.jsxs("div",{className:"rounded-xl border bg-white p-3 shadow-sm text-sm","data-guide":"askvx-digest",children:[t.jsx("div",{className:"font-medium text-slate-900",children:"Since your last visit"}),Kt?t.jsx("div",{className:"mt-1 text-xs text-slate-600",children:"No changes since last visit."}):t.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-slate-600",children:[t.jsxs("span",{children:["Contacts: +",T.format(A.contactsAdded)," / ",T.format(A.contactsUpdated)," updated"]}),t.jsxs("span",{children:["Appointments: ",T.format(A.appointments)]}),t.jsxs("span",{children:["Messages: ",T.format(A.messagesSent)]}),t.jsxs("span",{children:["Sync events: ",T.format(A.syncEvents)]})]}),!!(_?.recent_contacts||[]).length&&t.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Recent: ",(_?.recent_contacts||[]).map(e=>e.friendly_name||e.display_name||"Client").join(", ")]})]})]}),f===0&&P&&(S||et)&&t.jsx("div",{className:"mt-2 rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900","data-guide":"askvx-insights-cta",children:"Import is skipped for now. We’ll move ahead to your 14-day strategy next."}),f===0&&t.jsx("div",{className:"mt-2 flex items-center justify-end text-xs text-slate-500",children:t.jsx("span",{children:"Shift+Enter for newline"})}),f===0&&t.jsxs("div",{ref:St,className:"rounded-xl bg-white shadow-sm p-3 border flex-1 min-h-0 overflow-y-auto min-w-0","aria-live":"polite","aria-atomic":"false",role:"log","data-guide":"messages",children:[u.length===0&&t.jsx("div",{className:"text-sm text-slate-500",children:"Start a conversation below."}),t.jsxs("div",{className:"space-y-2",children:[u.map((e,a)=>t.jsx("div",{className:e.role==="user"?"text-right":"text-left",children:t.jsx("span",{className:"inline-block px-3 py-2 rounded-lg text-sm "+(e.role==="user"?"bg-sky-100 text-slate-900":"bg-slate-100 text-slate-900"),children:e.content})},a)),(g||R)&&t.jsx("div",{className:"text-left","aria-live":"assertive","aria-atomic":"true",children:t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm bg-slate-100 text-slate-900",children:[t.jsx("span",{children:"AskVX is typing"}),t.jsxs("span",{className:"inline-flex ml-1 items-end",children:[t.jsx(jt.span,{className:"w-1.5 h-1.5 bg-slate-600 rounded-full",animate:{y:[0,-3,0],opacity:[.5,1,.6]},transition:{duration:.9,repeat:1/0,ease:"easeInOut",delay:0}}),t.jsx(jt.span,{className:"w-1.5 h-1.5 bg-slate-600 rounded-full ml-1",animate:{y:[0,-3,0],opacity:[.5,1,.6]},transition:{duration:.9,repeat:1/0,ease:"easeInOut",delay:.15}}),t.jsx(jt.span,{className:"w-1.5 h-1.5 bg-slate-600 rounded-full ml-1",animate:{y:[0,-3,0],opacity:[.5,1,.6]},transition:{duration:.9,repeat:1/0,ease:"easeInOut",delay:.3}})]})]})})]})]}),f===0&&P&&t.jsxs("div",{className:"mt-2 rounded-xl border bg-white p-3 shadow-sm text-sm","data-guide":"askvx-strategy",children:[t.jsx("div",{className:"font-medium text-slate-900",children:"14-day strategy"}),t.jsx("div",{className:"mt-1 text-xs text-slate-600",children:W?"Your strategy is saved. Download it or rebuild after you update data.":S?"We’ll craft a starter plan from your brand profile. Import contacts later for richer insights.":"Use your AskVX snapshot to build a 14-day plan you can act on immediately."}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.jsx("button",{className:"rounded-full bg-slate-900 px-4 py-1.5 text-xs font-semibold text-white shadow disabled:opacity-60",onClick:At,disabled:C,children:C?"Preparing…":W?"Rebuild strategy":"Generate strategy"}),N&&t.jsx("a",{href:N,download:"brandvx-14-day-strategy.md",className:"rounded-full border border-slate-300 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50",children:"Download Markdown"})]}),Vt&&t.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"Saved to your brand memory. Ask VX will reference it on future chats."})]}),f===0&&r&&t.jsxs("div",{className:"mt-2","data-guide":"smart-action",children:[t.jsx("button",{className:"px-3 py-1.5 text-xs rounded-full border bg-white hover:shadow-sm",onClick:Xt,disabled:B,children:B?"Running…":r.label}),O&&t.jsxs("div",{className:"mt-1 text-[11px] text-slate-600",children:[O.status==="running"?"Starting…":`Result: ${String(O.status||"ok")}`,new URLSearchParams(typeof window<"u"?window.location.search:"").has("dev")&&t.jsx("pre",{className:"mt-1 whitespace-pre-wrap",children:JSON.stringify(O,null,2)})]})]}),f===0&&!st&&!wt&&t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[t.jsx("button",{className:"border rounded-md px-2 py-1 bg-white hover:shadow-sm",onClick:async()=>{l("What can brandVX do for me? Keep it concise and tailored to beauty pros."),await Promise.resolve(),Z()},children:"What can brandVX do?"}),t.jsx("button",{className:"border rounded-md px-2 py-1 bg-white hover:shadow-sm",onClick:async()=>{l("How do I get started? Give me the first 3 actions and where to click."),await Promise.resolve(),Z()},children:"How do I get started?"}),t.jsx("button",{className:"border rounded-md px-2 py-1 bg-white hover:shadow-sm",onClick:async()=>{l("What was my revenue for last week?"),await Promise.resolve(),Z()},children:"What was my revenue for last week?"})]}),f===0&&t.jsxs("div",{className:"flex gap-2 items-start shrink-0 pb-[max(env(safe-area-inset-bottom,0px),0px)]","data-guide":"composer",children:[t.jsx("textarea",{className:`flex-1 border rounded-md px-3 py-2 ${st?"min-h-[120px]":""}`,rows:3,placeholder:"How can I save you time today?",value:p,onFocus:()=>{p||l("")},onChange:e=>l(e.target.value),onKeyDown:Bt,ref:dt}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("button",{"data-guide":"ask-send",className:"border rounded-full px-4 py-2 bg-gradient-to-r from-blue-100 to-blue-300 hover:from-blue-200 hover:to-blue-400 shadow text-slate-900",onClick:Z,disabled:g||R,children:g?"Sending…":"Send"}),t.jsx("button",{className:"text-sm text-slate-600 hover:underline",onClick:Ot,children:"Clear"})]})]}),f===0&&Q&&t.jsxs("div",{className:"mt-2 flex gap-2 text-xs",children:[t.jsx("button",{className:"border rounded-md px-2 py-1 bg-white hover:shadow-sm",onClick:async()=>{try{await navigator.clipboard.writeText(Q)}catch{}},children:"Copy plan"}),t.jsx("button",{className:"border rounded-md px-2 py-1 bg-white hover:shadow-sm",onClick:async()=>{try{const e=await k();await x.post("/ai/chat/session/summary",{tenant_id:e,session_id:Y,summary:Q}),It(Q);try{rt("plan_pinned_dashboard")}catch{}try{const a=new URL(window.location.href);a.pathname="/workspace",a.search="?pane=dashboard&refresh=summary",window.location.assign(a.toString())}catch{}}catch{}},children:"Pin to Dashboard"})]}),!$&&t.jsx("div",{className:"text-xs text-slate-500 mt-1 shrink-0",children:"(Responses may take a moment to ensure quality!)"}),!1,f===1&&t.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"rounded-xl bg-white shadow-sm p-3 border","data-guide":"trainvx-notes",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Train VX"}),t.jsx("textarea",{className:"mt-2 w-full border rounded-md px-2 py-1 text-sm",rows:4,placeholder:"Add a brand fact, tone note, or preference…",value:gt,onChange:e=>_t(e.target.value)}),t.jsx("div",{className:"mt-2 flex justify-end",children:t.jsx("button",{className:"border rounded-md px-3 py-1 bg-white hover:shadow-sm text-xs",onClick:qt,disabled:Ct,children:Ct?"Saving…":"Save to training"})})]}),t.jsx(ae,{})]}),!st&&!wt&&t.jsxs("div",{className:"mt-2 rounded-xl bg-white shadow-sm p-3 border",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Last session summary"}),t.jsx("div",{className:"mt-2 text-sm text-slate-700 whitespace-pre-wrap min-h-[48px]",children:Ht})]}),(()=>{try{new URLSearchParams(window.location.search).get("onboard")==="1"&&xt&&localStorage.setItem("bvx_done_plan","1")}catch{}return null})()]})}function ae(){const{showToast:i}=Dt(),[p,l]=s.useState(!0),[u,b]=s.useState(!1),[c,g]=s.useState(!1),[I,R]=s.useState(""),[X,h]=s.useState(""),[r,y]=s.useState(""),[B,L]=s.useState(""),[O,M]=s.useState(""),[_,H]=s.useState(""),[$,ot]=s.useState({tone:"",brandProfile:"",avgPrice:"",avgTime:"",monthlyRent:"",primaryGoal:""});s.useEffect(()=>{(async()=>{try{const d=await k(),v=await x.get(`/settings?tenant_id=${encodeURIComponent(d)}`),w=v?.data?.brand_profile||{},q=v?.data?.goals||{},S=String(w?.voice||""),U=String(w?.about||""),C=String(v?.data?.avg_service_price_cents?(Number(v.data.avg_service_price_cents)/100).toFixed(2):""),G=String(v?.data?.avg_service_minutes||""),W=String(v?.data?.monthly_rent_cents?(Number(v.data.monthly_rent_cents)/100).toFixed(2):""),z=String(q?.primary||"");R(S),h(U),y(C),L(G),M(W),H(z),ot({tone:S,brandProfile:U,avgPrice:C,avgTime:G,monthlyRent:W,primaryGoal:z})}finally{l(!1)}})()},[]);const J=async()=>{if(c)try{b(!0);const d=await k(),v=I.trim(),w=X.trim(),q=_.trim(),S=r.trim(),U=B.trim(),C=O.trim(),G=Math.round(Number(S||"0")*100)||0,W=Math.round(Number(C||"0")*100)||0,z=Number(U||"0")||0,N={voice:v,about:w},ct={primary:q};await x.post("/settings",{tenant_id:d,brand_profile:N,goals:ct,avg_service_price_cents:G,avg_service_minutes:z,monthly_rent_cents:W}),R(v),h(w),H(q),y(S),L(U),M(C),ot({tone:v,brandProfile:w,avgPrice:S,avgTime:U,monthlyRent:C,primaryGoal:q}),g(!1),i({title:"Saved",description:"Profile updated."})}catch(d){i({title:"Save error",description:String(d?.message||d)})}finally{b(!1)}},it=()=>{R($.tone),h($.brandProfile),y($.avgPrice),L($.avgTime),M($.monthlyRent),H($.primaryGoal),g(!1)};return p?t.jsx("div",{className:"rounded-xl bg-white p-3 border text-sm text-slate-600",children:"Loading…"}):t.jsxs("div",{className:`rounded-xl bg-white shadow-sm p-3 border ${c?"border-sky-300 shadow-md":""}`,"data-guide":"trainvx-profile",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Brand profile"}),c&&t.jsx("div",{className:"mt-1 text-[11px] text-sky-700",children:"Editing mode • Save to lock in changes."}),t.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[t.jsxs("label",{className:"grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"Tone"}),t.jsx("input",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,value:I,onChange:d=>R(d.target.value),placeholder:"Warm, Editorial crisp…",disabled:!c})]}),t.jsxs("label",{className:"grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"Primary goal"}),t.jsx("input",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,value:_,onChange:d=>H(d.target.value),placeholder:"Fill Fridays, retain first‑timers…",disabled:!c})]}),t.jsxs("label",{className:"md:col-span-2 grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"About / Brand profile"}),t.jsx("textarea",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,rows:3,value:X,onChange:d=>h(d.target.value),placeholder:"Short brand description, specialties, vibe…",disabled:!c})]}),t.jsxs("label",{className:"grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"Avg service price ($)"}),t.jsx("input",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,inputMode:"decimal",value:r,onChange:d=>y(d.target.value),disabled:!c})]}),t.jsxs("label",{className:"grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"Avg service time (min)"}),t.jsx("input",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,inputMode:"numeric",value:B,onChange:d=>L(d.target.value),disabled:!c})]}),t.jsxs("label",{className:"grid gap-1",children:[t.jsx("span",{className:"text-slate-600 text-xs",children:"Monthly rent ($)"}),t.jsx("input",{className:`border rounded-md px-2 py-1 ${c?"":"bg-slate-50"}`,inputMode:"decimal",value:O,onChange:d=>M(d.target.value),disabled:!c})]})]}),t.jsx("div",{className:"mt-3 flex justify-end gap-2",children:c?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"rounded-md border px-3 py-1 text-xs text-slate-600 hover:bg-slate-50",onClick:it,disabled:u,children:"Cancel"}),t.jsx("button",{className:"rounded-md border border-slate-900 bg-slate-900 px-3 py-1 text-xs font-semibold text-white disabled:opacity-60",onClick:J,disabled:u,children:u?"Saving…":"Save"})]}):t.jsx("button",{className:"rounded-md border px-3 py-1 text-xs text-slate-700 hover:bg-slate-50",onClick:()=>g(!0),children:"Edit profile"})})]})}export{ge as default};
