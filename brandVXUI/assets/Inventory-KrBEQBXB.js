import{r as a,j as e}from"./react-vendor--lxKGBiW.js";import{a as l,g as o}from"./index-Bk3Do8do.js";import{s as j}from"./guide-D27LQTJO.js";import{E as U}from"./EmptyState-BVAWAqiR.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";import"./driver-D6Mpyj2M.js";function G(){const[r,c]=a.useState({}),[f,x]=a.useState({}),[S,k]=a.useState(!0),[w,b]=a.useState(""),[i,h]=a.useState([]),[g,_]=a.useState(void 0),[v,p]=a.useState(0),[d,N]=a.useState(0),u=8,[L,C]=a.useState(()=>{try{return parseInt(localStorage.getItem("bvx_low_threshold")||"5")||5}catch{return 5}});a.useEffect(()=>{(async()=>{try{const t=await l.get(`/inventory/metrics?tenant_id=${encodeURIComponent(await o())}`);c(t?.summary||{}),x(t?.last_sync||{}),h(t?.items||[]),p(Date.now())}finally{k(!1)}})()},[]),a.useEffect(()=>{try{new URLSearchParams(window.location.search).get("tour")==="1"&&j("inventory")}catch{}},[]),a.useEffect(()=>{(async()=>{try{const t=await l.post("/onboarding/analyze",{tenant_id:await o()});t?.summary?.ts&&_(Number(t.summary.ts))}catch{}finally{try{window.__bvxInventoryReady=1,window.dispatchEvent(new CustomEvent("bvx:inventory:ready"))}catch{}}})()},[]);const y=async t=>{const s=await l.post("/inventory/sync",{tenant_id:await o(),provider:t});b((()=>{try{return new URLSearchParams(window.location.search).has("dev")?JSON.stringify(s):""}catch{return""}})());const n=await l.get(`/inventory/metrics?tenant_id=${encodeURIComponent(await o())}`);c(n?.summary||{}),x(n?.last_sync||{}),h(n?.items||[]),p(Date.now())},I=async()=>{const t=await l.post("/inventory/merge",{tenant_id:await o(),strategy:"sku_then_name"});b((()=>{try{return new URLSearchParams(window.location.search).has("dev")?JSON.stringify(t):""}catch{return""}})());const s=await l.get(`/inventory/metrics?tenant_id=${encodeURIComponent(await o())}`);c(s?.summary||{}),x(s?.last_sync||{}),h(s?.items||[]),p(Date.now())};return S?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-16 rounded-lg bg-white border animate-pulse"},s))}),e.jsx("div",{className:"h-24 rounded-lg bg-white border animate-pulse"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Inventory"}),!!v&&e.jsxs("span",{className:"ml-2 text-[11px] text-slate-500",children:["Updated ",new Date(v).toLocaleTimeString()]}),e.jsx("button",{className:"text-sm text-slate-600 hover:underline","aria-label":"Open inventory guide",onClick:()=>j("inventory"),children:"Guide me"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:["Low‑stock threshold",e.jsx("input",{type:"number",min:0,className:"border rounded-md px-2 py-1 bg-white w-20",value:L,onChange:t=>{const s=Math.max(0,parseInt(t.target.value||"0")||0);C(s);try{localStorage.setItem("bvx_low_threshold",String(s))}catch{}}})]}),e.jsx("span",{className:"text-xs text-slate-500",children:"Used by low‑stock checks"})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-3 shadow-sm grid sm:grid-cols-2 lg:grid-cols-4 gap-3","data-guide":"kpis",children:[e.jsx(m,{label:"Products",value:r.products??0}),e.jsx(m,{label:"Low stock",value:r.low_stock??0}),e.jsx(m,{label:"Out of stock",value:r.out_of_stock??0}),e.jsx(m,{label:"Top seller",value:r.top_sku??"—"})]}),e.jsx("div",{className:"text-sm text-slate-600",children:"Connect Shopify/Square or add products manually to see inventory here."}),g&&e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Last analyzed: ",new Date(g*1e3).toLocaleString()]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-slate-700",children:Object.entries(f).map(([t,s])=>{const n=s?.ts?new Date((s?.ts||0)*1e3).toLocaleTimeString():"";return e.jsxs("span",{className:"px-2 py-1 rounded-md border bg-white",children:[t,": ",s?.status," ",n&&`· ${n}`]},t)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white hover:shadow-sm",onClick:()=>y("shopify"),children:"Sync now (Shopify)"}),e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white hover:shadow-sm",onClick:()=>y("square"),children:"Sync now (Square)"}),e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white hover:shadow-sm",onClick:()=>y("manual"),children:"Refresh (Manual)"}),e.jsx("button",{className:"px-3 py-2 rounded-md border bg-white hover:shadow-sm",onClick:I,children:"Merge duplicates"})]}),e.jsx("div",{className:"text-[11px] text-amber-700",children:"Some actions may require approval when auto-approve is off. Review in To‑Do."}),i.length===0?e.jsx(U,{title:"No inventory yet",description:"Connect Shopify/Square and sync to see items here."}):e.jsxs("div",{className:"rounded-xl border bg-white p-0 shadow-sm overflow-hidden",role:"region","aria-label":"Inventory table","data-guide":"table",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"SKU"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Stock"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Cost"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Price"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Provider"})]})}),e.jsx("tbody",{className:"divide-y",children:i.slice(d*u,(d+1)*u).map((t,s)=>e.jsxs("tr",{className:`hover:bg-slate-50 ${Number(t.stock)<=0?"bg-rose-50":Number(t.stock)<=5?"bg-amber-50":""}`,children:[e.jsx("td",{className:"px-3 py-2",children:t.sku}),e.jsx("td",{className:"px-3 py-2",children:t.name}),e.jsxs("td",{className:"px-3 py-2",children:[t.stock,Number(t.stock)<=0&&e.jsx("span",{className:"ml-2 text-[11px] text-rose-700",children:"Out"}),Number(t.stock)>0&&Number(t.stock)<=5&&e.jsx("span",{className:"ml-2 text-[11px] text-amber-700",children:"Low"})]}),e.jsxs("td",{className:"px-3 py-2",children:["$","{","it.cost","}"]}),e.jsxs("td",{className:"px-3 py-2",children:["$","{","it.price","}"]}),e.jsx("td",{className:"px-3 py-2",children:t.provider})]},s))})]}),e.jsx("div",{className:"p-3 text-[11px] text-slate-600",children:"Low‑stock threshold is 5 by default."})]}),i.length>0&&e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs mt-2",children:[e.jsx("button",{className:"px-2 py-1 rounded-md border bg-white disabled:opacity-50",onClick:()=>N(t=>Math.max(0,t-1)),disabled:d<=0,children:"← Prev"}),e.jsx("button",{className:"px-2 py-1 rounded-md border bg-white disabled:opacity-50",onClick:()=>N(t=>t+1),disabled:(d+1)*u>=i.length,children:"Next →"})]}),w&&new URLSearchParams(window.location.search).has("dev")&&e.jsx("pre",{className:"text-xs text-slate-700 whitespace-pre-wrap",children:w})]})}function m({label:r,value:c}){return e.jsxs("div",{className:"rounded-lg bg-white border p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:r}),e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:String(c)})]})}export{G as default};
