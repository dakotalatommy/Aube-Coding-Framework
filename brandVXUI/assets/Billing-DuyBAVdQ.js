import{e as R,r as i,j as e,E as T,p as F}from"./react-vendor--lxKGBiW.js";import{l as I}from"./stripe-CCy6EI-g.js";import{B as h}from"./Button-DlSz7573.js";import{b as l,a as b}from"./index-Bk3Do8do.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";const x={};function z(){const f=R(),[v,w]=i.useState(""),g=i.useRef(""),[k,y]=i.useState(!0),[d,n]=i.useState(""),u=x?.VITE_STRIPE_PUBLISHABLE_KEY||"pk_live_51RyvuWPc6PGNhmWgyrAJHjrLzHqQtFP68doiN4zXjIdwUmsT3GSAKpsXthWAUxQiDkMcxYdGZRokwFY52MFoSRIN002Gw00m3D",[N,$]=i.useState(""),o=u,_=i.useMemo(()=>I(o),[o]),[m,S]=i.useState(null),a=x?.VITE_STRIPE_BUY_BUTTON_147||"",c=x?.VITE_STRIPE_BUY_BUTTON_97||"";i.useEffect(()=>{},[u]),i.useEffect(()=>{try{l("billing_view")}catch{}},[]),i.useEffect(()=>{if(a||c)try{if(document.querySelector('script[src*="buy-button.js"]'))return;const s=document.createElement("script");s.async=!0,s.src="https://js.stripe.com/v3/buy-button.js",document.head.appendChild(s)}catch{}},[a,c]),i.useEffect(()=>{let t=!0;return(async()=>{try{y(!0),n("");try{const j=await fetch("https://api.brandvx.io/billing/config").then(B=>B.json());t&&S(j||{}),!u&&j?.publishable_key}catch{}const s=await b.post("/billing/create-setup-intent",{});if(!t)return;const r=String(s?.client_secret||"");r?(w(r),g.current=r):n("Billing is misconfigured: setup intent missing client_secret.")}catch(s){if(!t)return;n(s?.message||"Failed to initialize billing.")}finally{t&&y(!1)}})(),()=>{t=!1}},[]);const p=v||g.current,E=`${o.slice(0,6)}…${o.slice(-4)}`,P=!!d||new URLSearchParams(window.location.search).has("dev");return e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("button",{onClick:()=>f("/workspace?pane=integrations"),className:"text-sm text-slate-700 hover:text-slate-900 inline-flex items-center gap-1",children:[e.jsx("span",{"aria-hidden":!0,children:"←"})," Return to workspace"]})}),e.jsxs("div",{className:"rounded-2xl border bg-white/80 backdrop-blur p-5 shadow-sm",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Add payment method"}),e.jsxs("div",{className:"text-slate-600 mt-1",children:["Pay ",e.jsx("span",{className:"font-semibold",children:"$97 today"})," to lock your Founding Member price at $97/month — or pay nothing today and get a ",e.jsx("span",{className:"font-semibold",children:"7‑day free trial"})," locking in your Founding Member price of $147."]}),d&&e.jsx("div",{className:"mt-3 rounded-lg border border-rose-200 bg-rose-50/60 text-rose-800 px-3 py-2 text-sm",children:d}),P&&e.jsxs("div",{className:"mt-2 text-[11px] text-slate-600",children:[e.jsxs("div",{children:["Stripe publishable: ",E||"missing"]}),e.jsxs("div",{children:["SetupIntent secret present: ",p?"yes":"no"]})]}),e.jsx("div",{className:"mt-5",children:k||!_&&!(a||c)?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 w-full rounded-xl bg-slate-100"}),e.jsx("div",{className:"h-10 w-full mt-3 rounded-xl bg-slate-100"}),e.jsx("div",{className:"h-10 w-40 mt-4 rounded-xl bg-slate-100"})]}):e.jsx(T,{stripe:_,options:{clientSecret:p,appearance:{theme:"flat"}},children:e.jsx("div",{className:"grid gap-3",children:a||c?e.jsxs("div",{className:"grid gap-3",children:[a&&e.jsx("stripe-buy-button",{"buy-button-id":a,"publishable-key":o}),c&&e.jsx("stripe-buy-button",{"buy-button-id":c,"publishable-key":o})]}):e.jsx(F,{options:{layout:"tabs"}})})},p)}),!(a||c)&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 flex-wrap",children:[e.jsx(h,{onClick:async()=>{try{l("billing_start_subscription",{plan:"147_monthly"})}catch{}try{const t=(m?.price_147||"price_1S06UXPc6PGNhmWgwLwohes2").trim(),s=Number((m?.trial_days??"7")||"7");if(!t){n("Price 147 is not configured on the server.");return}const r=await b.post("/billing/create-checkout-session",{price_id:t,mode:"subscription",trial_days:s});r?.url&&(window.location.href=r.url)}catch{n("Failed to start subscription.")}},children:"Start subscription — $147/mo"}),e.jsx(h,{variant:"outline",onClick:async()=>{try{l("billing_start_founder",{plan:"founder_97_monthly"})}catch{}try{const t=(m?.price_97||"price_1S06W2Pc6PGNhmWgyEnKQwSH").trim(),s=0;if(!t){n("Price 97 is not configured on the server.");return}const r=await b.post("/billing/create-checkout-session",{price_id:t,mode:"subscription",trial_days:s});r?.url&&(window.location.href=r.url)}catch{n("Failed to start $97/mo checkout.")}},children:"Lock $97/mo (Founding Member)"}),e.jsx(h,{variant:"ghost",onClick:()=>{try{l("billing_skip")}catch{}f("/workspace?pane=dashboard")},children:"Skip for now"})]}),e.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Charges depend on your selection: $97 charges today; $147 starts a 7‑day free trial. You’ll be notified before any future charges."})]})]})}export{z as default};
