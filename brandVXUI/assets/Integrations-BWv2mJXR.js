const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driver-D6Mpyj2M.js","assets/driver-DB0Q8XAf.css"])))=>i.map(i=>d[i]);
import{r as m,_ as ne,j as t}from"./react-vendor--lxKGBiW.js";import{u as Re,a as r,g as i,A as Ie,t as z}from"./index-Bk3Do8do.js";import{B as n}from"./Button-DlSz7573.js";import{driver as Le}from"./driver-D6Mpyj2M.js";import{U as y}from"./strings-ZJ386RGO.js";import{S as $e}from"./StatusBadge-k1-2v4io.js";import"./radix-Dc_FVRD7.js";import"./sentry-ZUDTCraJ.js";import"./howler-DHXmObXC.js";import"./physics-DQSz9XbC.js";import"./analytics-BPch_qa6.js";import"./supabase-CZcX4Eou.js";function Fe(){const{showToast:u}=Re(),_=(()=>{try{return new URLSearchParams(window.location.search)}catch{return new URLSearchParams}})(),re=(()=>{try{return(_.get("provider")||"").toLowerCase()}catch{return""}})(),ie=(()=>{try{return _.get("return")||""}catch{return""}})(),oe=(()=>{try{return _.get("onboard")==="1"}catch{return!1}})(),[w]=m.useState(re),B=!0,ce=typeof window<"u"&&new URLSearchParams(window.location.search).has("dev"),le=(()=>{try{return new URLSearchParams(window.location.search).has("dev")}catch{return!1}})(),[c,H]=m.useState({tone:"helpful",services:["sms","email"],auto_approve_all:!1,pause_automations:!1,quiet_hours:{start:"21:00",end:"08:00"},brand_profile:{name:"",voice:"",about:""},metrics:{monthly_revenue:"",avg_service_price:"",avg_service_time:"",rent:""},goals:{primary_goal:""},preferences:{}}),[Pe,G]=m.useState({providers:{},loaded:!1}),de=(()=>{try{return new URLSearchParams(window.location.search).get("demo")==="1"}catch{return!1}})(),[me,h]=m.useState(""),[F,x]=m.useState(""),[g,V]=m.useState({}),[o,l]=m.useState(!1),[d,E]=m.useState({connected:!1,first_sync_done:!1,counts:{},connectedMap:{},providers:{}}),[T,K]=m.useState(""),[I,J]=m.useState(null),[W,X]=m.useState([]),[A,O]=m.useState(null),[L,pe]=m.useState({}),[M,ue]=m.useState({}),[v,he]=m.useState({}),xe=Math.floor(Date.now()/1e3),$=e=>e&&e>0?new Date(Number(e)*1e3).toLocaleString():"",f=e=>{const s=Number(v?.[e]?.expires_at||0);return s>0&&s-xe<168*3600},[P,ge]=m.useState([]),Z=async()=>{try{const e=await i(),s=await r.get(`/integrations/events?tenant_id=${encodeURIComponent(e)}&limit=50`);ge(Array.isArray(s?.items)?s.items:[])}catch{}},j=e=>{try{const s=d?.connectedMap||{};if(s&&typeof s[e]=="string")return String(s[e])==="connected";if(L&&typeof L[e]=="boolean")return!!L[e];if(Array.isArray(W))return W.some(a=>(a?.provider||"")===e)}catch{}return!1},be=e=>{try{return!!(c?.providers_live||{})[e]}catch{return!1}},ve=e=>{try{return e.some(s=>j(s))}catch{return!1}},U=e=>{try{if(le)return!0;const s=Array.isArray(e)?e:[e];return s.some(a=>be(a))||ve(s)}catch{return!0}},N=e=>j(e)?`Reconnect ${e.charAt(0).toUpperCase()+e.slice(1)}`:`Connect ${e.charAt(0).toUpperCase()+e.slice(1)}`,D=async()=>{try{const e=await r.post("/onboarding/analyze",{tenant_id:await i()});E({...e?.summary,connectedMap:e?.summary?.connected||{},providers:e?.summary?.providers||{}});const s=new Date;h(`Re‑analyzed at ${s.toLocaleTimeString()}`);try{u({title:"Re‑analyzed",description:s.toLocaleTimeString()})}catch{}try{const a=await i();if(a){const p=await r.get(`/integrations/connected-accounts?tenant_id=${encodeURIComponent(a)}`);X(Array.isArray(p?.items)?p.items:[]),O(p?.last_callback||null);try{const b=await r.get(`/integrations/status?tenant_id=${encodeURIComponent(a)}`),R=b?.providers||{},Q={},ee={};Object.entries(R).forEach(([te,se])=>{Q[te]=!!se?.linked;const ae=Number(se?.last_sync||0);ae>0&&(ee[te]=ae)}),pe(Q),ue(ee),he(R),!A&&b?.last_callback&&O(b.last_callback)}catch{}}}catch{}try{const a=await i(),p=await r.get(`/integrations/status?tenant_id=${encodeURIComponent(a)}`);G({providers:p?.providers||{},loaded:!0})}catch{G({providers:{},loaded:!1})}}catch(e){h(String(e?.message||e))}};m.useEffect(()=>{(async()=>{try{const e=await r.get(`/settings?tenant_id=${encodeURIComponent(await i())}`);H({auto_approve_all:!1,providers_live:{},...e?.data||{}})}catch{}try{const e=await r.post("/onboarding/analyze",{tenant_id:await i()});E({...e?.summary,connectedMap:e?.summary?.connected||{},providers:e?.summary?.providers||{}})}catch{}try{const e=await i();if(e){const s=await r.get(`/integrations/connected-accounts?tenant_id=${encodeURIComponent(e)}`);X(Array.isArray(s?.items)?s.items:[]),O(s?.last_callback||null)}}catch{}try{const e=await r.get(`/integrations/booking/square/link?tenant_id=${encodeURIComponent(await i())}`);K(e?.url||"")}catch{}try{setTimeout(async()=>{if(!T)try{const e=await r.get(`/integrations/booking/square/link?tenant_id=${encodeURIComponent(await i())}`);e?.url&&K(e.url)}catch{}},1500)}catch{}try{const e=await r.get("/integrations/redirects");J(e)}catch{try{const e=Ie,s=typeof window<"u"?window.location.origin:"";J({oauth:{google:`${e}/oauth/google/callback`,apple:`${e}/oauth/apple/callback`,square:`${e}/oauth/square/callback`,acuity:`${e}/oauth/acuity/callback`,hubspot:`${e}/oauth/hubspot/callback`,facebook:`${e}/oauth/facebook/callback`,instagram:`${e}/oauth/instagram/callback`,shopify:`${e}/oauth/shopify/callback`},webhooks:{stripe:`${e}/billing/webhook`},post_auth_redirect:{supabase_email:`${s}/onboarding?offer=1`}})}catch{}}try{new URLSearchParams(window.location.search).has("dev")&&await Z()}catch{}})()},[]),m.useEffect(()=>{try{const e=_.get("connected")==="1",s=_.get("error")||"";if(w&&e){try{u({title:`${w.charAt(0).toUpperCase()+w.slice(1)} connected`})}catch{}D();const a=(()=>{try{return sessionStorage.getItem("bvx_showcase_intent")==="1"}catch{return!1}})();oe||a?setTimeout(()=>{try{const p=new URL(window.location.href);p.pathname="/workspace",p.searchParams.set("pane","dashboard"),p.searchParams.delete("provider"),p.searchParams.delete("connected"),p.searchParams.delete("error"),window.history.replaceState({},"",p.toString()),sessionStorage.setItem("bvx_showcase_resuming","1"),window.dispatchEvent(new CustomEvent("bvx:showcase:resume")),sessionStorage.removeItem("bvx_showcase_intent")}catch{}},900):ie==="workspace"&&setTimeout(()=>{try{window.history.replaceState({},"","/workspace?pane=dashboard")}catch{}},900)}else if(w&&s)try{u({title:`${w} connection failed`,description:s})}catch{}}catch{}},[w]),m.useEffect(()=>{(async()=>{try{if(new URLSearchParams(window.location.search).get("tour")==="twilio"){const s=await ne(()=>import("./driver-D6Mpyj2M.js"),__vite__mapDeps([0,1]));(s.driver||s.default?.driver||s.default)({showProgress:!0,steps:[{popover:{title:"SMS via Twilio",description:"Use a dedicated business number. Personal numbers are not supported yet."}},{element:'[data-guide="twilio"]',popover:{title:"Twilio SMS",description:"Connect a Twilio number for outbound/inbound SMS. Porting personal numbers will come later."}}]}).drive()}}catch{}})()},[]),m.useEffect(()=>{(async()=>{try{if(new URLSearchParams(window.location.search).get("tour")==="1"){const s=await ne(()=>import("./driver-D6Mpyj2M.js"),__vite__mapDeps([0,1]));(s.driver||s.default?.driver||s.default)({showProgress:!0,steps:[{popover:{title:"Integrations",description:"Connect booking, CRM, messaging, and inventory."}},{element:'[data-guide="providers"]',popover:{title:"Providers",description:"Each card shows connection status and actions."}},{element:'[data-guide="twilio"]',popover:{title:"SMS via Twilio",description:"Use a dedicated business number. Personal numbers are not supported yet."}}]}).drive()}}catch{}})()},[]);const q=async(e,s)=>{try{H(a=>({...a,providers_live:{...a.providers_live||{},[e]:s}})),await r.post("/settings",{tenant_id:await i(),providers_live:{...c.providers_live||{},[e]:s}});try{u({title:"Mode updated",description:`${e}: ${s?"Live":"Demo"}`})}catch{}}catch(a){x(String(a?.message||a))}},Y=()=>{try{const e=new Date().getTimezoneOffset();return Math.round(-e/60)}catch{return 0}},fe=async()=>{try{l(!0);const e=await r.post("/ai/tools/execute",{tenant_id:await i(),name:"messages.send",params:{tenant_id:await i(),contact_id:"c_demo",channel:"email",subject:"brandVX Test",body:"<p>Hello from brandVX</p>"},require_approval:!1});h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?JSON.stringify(e):""}catch{return""}})());try{u({title:e?.status==="ok"||e?.status==="pending"?"Test email sent":"Test email failed",description:e?.status==="ok"||e?.status==="pending"?"Email sent successfully":e?.error||e?.status||""})}catch{}}catch(e){h(String(e?.message||e))}finally{l(!1)}},ye=async()=>{try{l(!0);try{await r.post("/settings",{tenant_id:await i(),guide_done:!1,welcome_seen:!1})}catch{}try{localStorage.setItem("bvx_onboarding_done","1"),localStorage.removeItem("bvx_guide_done"),localStorage.removeItem("bvx_quickstart_completed"),localStorage.removeItem("bvx_tour_seen_workspace_intro"),localStorage.removeItem("bvx_billing_dismissed"),sessionStorage.removeItem("bvx_intro_session"),localStorage.setItem("bvx_force_welcome_modal","1"),localStorage.removeItem("bvx_force_start_tour")}catch{}try{document.querySelectorAll(".driver-overlay, .driver-popover").forEach(e=>{try{e.parentElement?.removeChild(e)}catch{}}),document.body.classList.remove("driver-active","driver-fade","bvx-center-popover-body")}catch{}try{u({title:"Walkthrough restarted",description:"Returning to Dashboard…"})}catch{}setTimeout(()=>{try{window.location.assign("/workspace?pane=dashboard")}catch{window.location.href="/workspace?pane=dashboard"}},150)}finally{l(!1)}},k=({status:e,label:s,warn:a})=>e==="pending"?t.jsx("span",{className:"text-[11px] text-slate-600 capitalize",children:s||e}):t.jsx($e,{status:e,label:s,warn:a}),we=async()=>{try{l(!0);const e=await r.post("/integrations/crm/hubspot/upsert",{tenant_id:await i(),obj_type:"contact",attrs:{email:"demo@example.com",firstName:"Demo",lastName:"User"},idempotency_key:"demo_contact_1"});h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?JSON.stringify(e):""}catch{return""}})());try{u({title:"HubSpot sample synced",description:"HubSpot sample contact synced"})}catch{}}catch(e){h(String(e?.message||e))}finally{l(!1)}},je=async()=>{try{l(!0);const e=await r.post("/crm/hubspot/import",{tenant_id:await i()}),s=Number(e?.imported||0);h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?`HubSpot import: ${s} contacts`:""}catch{return""}})());try{u({title:"HubSpot import",description:`${s} contacts imported`})}catch{}}catch(e){x(String(e?.message||e))}finally{l(!1)}},ke=async e=>{try{l(!0);const s=await r.post("/calendar/sync",{tenant_id:await i(),provider:e});h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?`Calendar sync (${e}): ${s?.status||"done"}`:""}catch{return""}})());try{u({title:s?.status==="ok"||s?.status==="pending"?"Calendar sync started":"Calendar sync failed",description:e})}catch{}}catch(s){x(String(s?.message||s))}finally{l(!1)}},_e=async()=>{try{l(!0);const e=await r.post("/calendar/merge",{tenant_id:await i()}),s=Number(e?.merged||0);h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?`Calendar merged: ${s} duplicates dropped`:""}catch{return""}})());try{u({title:s>=0?"Calendar merged":"Calendar merge",description:`${s} drops`})}catch{}}catch(e){x(String(e?.message||e))}finally{l(!1)}},Ne=async()=>{try{l(!0);const e=await r.get("/integrations/rls/selfcheck");h((()=>{try{return new URLSearchParams(window.location.search).has("dev")?`RLS ok for tenant ${e?.tenant_id||""}: ${JSON.stringify(e?.counts||{})}`:""}catch{return""}})());try{u({title:"RLS self-check",description:"OK"})}catch{}}catch(e){x(String(e?.message||e))}finally{l(!1)}},Se=async()=>{try{l(!0);const e=await r.post("/ai/tools/execute",{tenant_id:await i(),name:"connectors.cleanup",params:{tenant_id:await i()},require_approval:!1,idempotency_key:`connectors_cleanup_${Date.now()}`});h(`Connectors cleaned: ${Number(e?.deleted||0)} removed`);try{u({title:"Connectors cleaned"})}catch{}}catch(e){x(String(e?.message||e))}finally{l(!1)}},Ce=()=>{T&&window.open(T,"_blank")},S=async e=>{try{V(a=>({...a,[e]:!0})),x("");try{z("integrations.connect.click",{provider:e})}catch{}try{sessionStorage.setItem("bvx_showcase_intent","1")}catch{}if((e==="facebook"||e==="instagram")&&d?.providers?.[e]===!1){x("Pending app credentials — configure Facebook/Instagram OAuth to enable.");return}const s=await r.get(`/oauth/${e}/login?tenant_id=${encodeURIComponent(await i())}&return=workspace`,{timeoutMs:25e3});if(s?.url){try{window.location.href=s.url}catch{window.location.assign(s.url)}setTimeout(()=>{try{document.visibilityState==="visible"&&window.location.assign(s.url)}catch{}},600)}else setTimeout(async()=>{try{try{z("integrations.connect.retry",{provider:e})}catch{}const a=await r.get(`/oauth/${e}/login?tenant_id=${encodeURIComponent(await i())}&return=workspace`,{timeoutMs:2e4});if(a?.url){try{window.location.href=a.url}catch{window.location.assign(a.url)}setTimeout(()=>{try{document.visibilityState==="visible"&&window.location.assign(a.url)}catch{}},600)}else x("Connect link unavailable. Verify provider credentials, sandbox vs prod, and callback URLs. Use “View redirect URIs” with ?dev=1.")}catch{}},800)}catch(s){const a=String(s?.message||s||"");/abort/i.test(a)||/timeout/i.test(a)?x("Connect timed out. Please try again. If it persists, copy the connect URL from the Network tab and open it."):x(a)}finally{V(s=>({...s,[e]:!1}))}},C=async e=>{try{l(!0),x("");const s=await r.post("/oauth/refresh",{tenant_id:await i(),provider:e});s?.status!=="ok"?x(s?.message||s?.status||"Refresh failed"):h("Refreshed");try{const a=await r.post("/onboarding/analyze",{tenant_id:await i()});E({...a?.summary,connectedMap:a?.summary?.connected||{},providers:a?.summary?.providers||{}})}catch{}}finally{l(!1)}};return t.jsxs("div",{className:"space-y-3 overflow-hidden min-h-[calc(100vh-48px)]",children:[t.jsxs("div",{className:"flex items-center sticky top-0 z-10 bg-white/80 backdrop-blur rounded-md px-1 py-1",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Settings"}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[t.jsxs("span",{className:"text-xs text-slate-600 px-2 py-1 rounded-md border bg-white/70",children:["TZ: ",Intl.DateTimeFormat().resolvedOptions().timeZone," (UTC",Y()>=0?"+":"",Y(),")"]}),t.jsx(n,{variant:"outline",size:"sm","aria-label":"Restart onboarding",disabled:o,onClick:ye,children:"Restart onboarding"}),t.jsx(n,{variant:"outline",size:"sm","aria-label":"Open integrations guide",onClick:()=>{try{z("integrations.guide.open",{area:"integrations"})}catch{}Le({showProgress:!0,steps:[{popover:{title:"Integrations",description:"Connect booking, CRM, messaging, and inventory."}},{element:'[data-guide="providers"]',popover:{title:"What each does",description:"Booking (Square/Acuity), Calendar (Google/Apple), CRM (HubSpot), Messaging (Twilio/SendGrid), Commerce (Shopify)."}},{element:'[data-guide="reanalyze"]',popover:{title:"Re‑analyze",description:"Re‑pull provider deltas and refresh KPIs after connecting or changing settings."}}]}).drive()},children:y.ctas.tertiary.guideMe}),t.jsx(n,{variant:"outline",size:"sm",onClick:()=>{window.location.href="/ask"},children:"AskVX"}),t.jsx(n,{variant:"outline",size:"sm",onClick:()=>{window.location.href="/billing"},children:"Billing"})]})]}),t.jsxs("section",{className:"rounded-2xl border bg-white p-3 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-slate-800",children:"Booking"}),t.jsx("div",{className:"text-xs text-slate-600",children:"Manage your booking links and confirmations."}),t.jsx("div",{className:"mt-2 flex items-center gap-2",children:t.jsx(n,{variant:"outline",size:"sm",onClick:()=>{try{window.open("https://squareup.com/appointments","_blank")}catch{window.location.href="https://squareup.com/appointments"}},children:"Open Square booking"})})]}),(()=>{try{const e=Math.floor(Date.now()/1e3),s=[];if(Object.entries(v||{}).forEach(([a,p])=>{const b=Number(p?.expires_at||0);b>0&&b-e<168*3600&&s.push(a)}),s.length>0)return t.jsxs("div",{className:"rounded-md border bg-amber-50 border-amber-200 text-amber-900 text-xs px-2 py-1",children:["Tokens expiring soon: ",s.join(", "),". Click Refresh to renew."]})}catch{}return null})(),de&&t.jsx("div",{className:"rounded-md border bg-amber-50 border-amber-200 text-amber-900 text-xs px-2 py-1 inline-block",children:"Demo mode — external provider connections are off. Explore UI and previews here; enable Twilio/SendGrid after signup."}),F&&t.jsxs("div",{className:"text-xs text-rose-700 bg-rose-50 border border-rose-100 rounded-md px-2 py-1 inline-block",children:[F,t.jsx("div",{className:"mt-1 text-[11px] text-rose-700/90",children:"Tips: verify client ID/secret, redirect URI matches backend callback, and sandbox vs prod app settings."})]}),t.jsxs("div",{className:"grid gap-3 max-w-xl",children:[A&&t.jsxs("div",{className:"text-[11px] text-slate-600",children:["Last OAuth callback: ",new Date(Number(A?.ts||0)*1e3).toLocaleString()," · ",String(A?.action||"")]}),t.jsx("section",{className:"rounded-2xl p-3 bg-white/60 backdrop-blur border border-white/70 shadow-sm"})]}),t.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-1 overflow-hidden","data-guide":"providers",children:[ce&&I&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm md:col-span-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Redirect URIs"}),t.jsx(n,{variant:"outline",size:"sm",onClick:async()=>{try{const e=[];Object.entries(I.oauth||{}).forEach(([s,a])=>e.push(`${s}: ${a}`)),Object.entries(I.webhooks||{}).forEach(([s,a])=>e.push(`${s} webhook: ${a}`)),await navigator.clipboard.writeText(e.join(`
`)),h("Copied all redirect URIs");try{u({title:"Copied",description:"Redirect URIs copied"})}catch{}}catch{h("Copy failed")}},children:"Copy all"})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-2 text-xs",children:[Object.entries(I.oauth||{}).map(([e,s])=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-28 capitalize text-slate-600",children:e}),t.jsx("input",{readOnly:!0,className:"flex-1 border rounded-md px-2 py-1 bg-white",value:String(s),onFocus:a=>a.currentTarget.select()})]},e)),Object.entries(I.webhooks||{}).map(([e,s])=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"w-28 capitalize text-slate-600",children:[e," webhook"]}),t.jsx("input",{readOnly:!0,className:"flex-1 border rounded-md px-2 py-1 bg-white",value:String(s),onFocus:a=>a.currentTarget.select()})]},e))]})]}),d?.providers?.hubspot!==!1&&U("hubspot")&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"HubSpot"}),t.jsx("div",{className:"text-sm text-slate-600",children:"CRM sync (contacts + properties)"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{status:j("hubspot")?"connected":c.providers_live?.hubspot?"configured":"pending",warn:f("hubspot")}),t.jsxs("label",{className:"inline-flex items-center gap-1 text-[11px]",children:[t.jsx("span",{className:`${c.providers_live?.hubspot?"text-emerald-700":"text-slate-600"}`,children:c.providers_live?.hubspot?"Live":"Demo"}),t.jsx("input",{type:"checkbox",checked:!!c.providers_live?.hubspot,onChange:e=>q("hubspot",e.target.checked)})]})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[t.jsx(n,{variant:"outline",disabled:o||g.hubspot||d?.providers?.hubspot===!1,onClick:()=>S("hubspot"),children:g.hubspot?"Connecting…":N("hubspot")}),t.jsx(n,{variant:"outline",disabled:o||d?.providers?.hubspot===!1,onClick:we,children:"Sync sample contact"}),t.jsx(n,{variant:"outline",disabled:o||d?.providers?.hubspot===!1,onClick:je,children:"Import contacts"}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>C("hubspot"),children:"Refresh"}),v?.hubspot?.last_sync&&t.jsxs("span",{className:"text-[11px] text-slate-600",children:["Last sync: ",$(v.hubspot.last_sync)]}),f("hubspot")&&t.jsx("span",{className:"text-[11px] text-amber-700",children:"Token expiring soon"})]}),d?.providers?.hubspot===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure HubSpot OAuth to enable."}),t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Note: Contact syncs may require approval if auto-approve is disabled."})]}),t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Square"}),t.jsx("div",{className:"text-sm text-slate-600",children:"Booking & clients (import contacts, backfill metrics)"})]}),t.jsx(k,{status:d?.connectedMap?.square==="connected"?"connected":c.providers_live?.square?"configured":"pending",warn:f("square")})]}),w==="square"&&_.get("connected")==="1"&&t.jsx("div",{className:"mb-2 text-xs rounded-md px-2 py-1 bg-emerald-50 border border-emerald-100 text-emerald-700",children:"Square connected. You can import contacts now."}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[T&&t.jsx(n,{variant:"outline",disabled:o||d?.providers?.square===!1,onClick:Ce,children:"Open Square booking"}),t.jsx(n,{variant:"outline",disabled:o||g.square||d?.providers?.square===!1,onClick:()=>S("square"),children:g.square?"Connecting…":N("square")}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>{C("square");try{u({title:y.ctas.secondary.refresh})}catch{}},children:"Refresh"}),t.jsx(n,{variant:"outline",disabled:o,onClick:async()=>{try{l(!0);const e=await r.post("/ai/tools/execute",{tenant_id:await i(),name:"contacts.import.square",params:{tenant_id:await i()},require_approval:!1,idempotency_key:`square_import_${Date.now()}`});if(typeof e?.imported=="number"){h(`Imported ${e?.imported||0} contacts from Square`);try{u({title:"Imported",description:`${Number(e?.imported||0)} contacts`})}catch{}}else if(e?.error||e?.detail){const s=e?.detail||e?.error||"Import failed";x(`Import failed: ${s}. Try Refresh, then Connect again if needed.`)}else h("Import completed");try{await r.post("/integrations/booking/square/backfill-metrics",{tenant_id:await i()})}catch{}try{await D()}catch{}}catch{x("Import failed. Verify Square is connected, then click Refresh and try again.")}finally{l(!1)}},children:"Import contacts"}),L.square&&M.square&&t.jsxs("span",{className:"text-[11px] text-slate-600",children:["Last sync: ",new Date(Number(M.square)*1e3).toLocaleString()]})]}),d?.providers?.square===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure Square OAuth to enable."}),t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Note: Imports may queue approvals when auto-approve is off."})]}),t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Acuity"}),t.jsx("div",{className:"text-sm text-slate-600",children:"Bookings (import appointments; contacts inferred from bookings)"})]}),t.jsx(k,{status:d?.connectedMap?.acuity==="connected"?"connected":c.providers_live?.acuity?"configured":"pending",warn:f("acuity")})]}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[t.jsx(n,{variant:"outline",disabled:o||g.acuity||d?.providers?.acuity===!1,onClick:()=>S("acuity"),children:g.acuity?"Connecting…":N("acuity")}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>{C("acuity");try{u({title:y.ctas.secondary.refresh})}catch{}},children:"Refresh"}),t.jsx(n,{variant:"outline",disabled:o||d?.providers?.acuity===!1,onClick:async()=>{try{l(!0);const e=await r.post("/integrations/booking/acuity/import",{tenant_id:await i(),since:"0",until:"",cursor:""}),s=Number(e?.imported||0);try{u({title:"Imported",description:`${s} appointments`})}catch{}h(`Acuity import: ${s} appointments`);try{await D()}catch{}}catch(e){x(String(e?.message||e))}finally{l(!1)}},children:"Import contacts"}),L.acuity&&M.acuity&&t.jsxs("span",{className:"text:[11px] text-slate-600",children:["Last sync: ",new Date(Number(M.acuity)*1e3).toLocaleString()]})]}),d?.providers?.acuity===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure Acuity OAuth to enable."})]}),U("sendgrid")&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"SendGrid"}),t.jsx("div",{className:"text-sm text-slate-600",children:"Transactional email"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{status:j("sendgrid")?"connected":c.providers_live?.sendgrid?"configured":"pending",warn:!1}),t.jsxs("label",{className:"inline-flex items-center gap-1 text-[11px]",children:[t.jsx("span",{className:`${c.providers_live?.sendgrid?"text-emerald-700":"text-slate-600"}`,children:c.providers_live?.sendgrid?"Live":"Demo"}),t.jsx("input",{type:"checkbox",checked:!!c.providers_live?.sendgrid,onChange:e=>q("sendgrid",e.target.checked)})]})]})]}),t.jsx("div",{className:"mt-3 flex gap-2",children:t.jsx(n,{variant:"outline",disabled:o,onClick:fe,children:y.ctas.secondary.sendTestEmail})}),t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Note: Test emails may require approval if auto-approve is disabled."}),t.jsxs("div",{className:"mt-2 rounded-md border bg-slate-50 p-3 text-xs text-slate-700",children:[t.jsx("div",{className:"font-medium text-slate-800",children:"Deliverability"}),t.jsx("div",{className:"mt-1",children:"Add SPF and DKIM records for your sending domain to improve inbox placement."}),t.jsxs("ul",{className:"list-disc list-inside mt-1",children:[t.jsx("li",{children:"SPF: include:sendgrid.net"}),t.jsx("li",{children:"DKIM: create CNAMEs in SendGrid → Settings → Sender Authentication"})]}),t.jsx("div",{className:"mt-1",children:"After updating DNS, click Refresh to re‑check status."})]})]}),U("google")&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Google Calendar"}),t.jsx("div",{className:"text-sm text-slate-600",children:"One-way sync and merge bookings for now"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{status:j("google")?"connected":c.providers_live?.google?"configured":"pending",warn:f("google")}),t.jsxs("label",{className:"inline-flex items-center gap-1 text-[11px]",children:[t.jsx("span",{className:`${c.providers_live?.google?"text-emerald-700":"text-slate-600"}`,children:c.providers_live?.google?"Live":"Demo"}),t.jsx("input",{type:"checkbox",checked:!!c.providers_live?.google,onChange:e=>q("google",e.target.checked)})]})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[t.jsx(n,{variant:"outline",disabled:o||g.google||d?.providers?.google===!1,onClick:()=>S("google"),children:g.google?"Connecting…":N("google")}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>window.open("/workspace?pane=calendar","_self"),children:y.ctas.secondary.openCalendar}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>ke("google"),children:"Sync calendar"}),t.jsx(n,{variant:"outline",disabled:o,onClick:_e,children:"Merge duplicates"}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>C("google"),children:y.ctas.secondary.refresh}),v?.google?.last_sync&&t.jsxs("span",{className:"text-[11px] text-slate-600",children:["Last sync: ",$(v.google.last_sync)]}),f("google")&&t.jsx("span",{className:"text-[11px] text-amber-700",children:"Token expiring soon"})]}),d?.providers?.google===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure Google OAuth to enable."})]}),U("instagram")&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Instagram"}),t.jsx("div",{className:"text-sm text-slate-600",children:"DMs & comments in Master Inbox"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{status:j("instagram")?"connected":c.providers_live?.instagram?"configured":"pending",warn:f("instagram")}),t.jsxs("label",{className:"inline-flex items-center gap-1 text-[11px]",children:[t.jsx("span",{className:`${c.providers_live?.instagram?"text-emerald-700":"text-slate-600"}`,children:c.providers_live?.instagram?"Live":"Demo"}),t.jsx("input",{type:"checkbox",checked:!!c.providers_live?.instagram,onChange:e=>q("instagram",e.target.checked)})]})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[t.jsx(n,{variant:"outline",disabled:o||g.instagram||d?.providers?.instagram===!1,onClick:()=>S("instagram"),children:g.instagram?"Connecting…":N("instagram")}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>window.open("/workspace?pane=messages","_self"),children:y.ctas.secondary.openInbox}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>C("instagram"),children:y.ctas.secondary.refresh}),v?.instagram?.last_sync&&t.jsxs("span",{className:"text-[11px] text-slate-600",children:["Last sync: ",$(v.instagram.last_sync)]}),f("instagram")&&t.jsx("span",{className:"text-[11px] text-amber-700",children:"Token expiring soon"})]}),d?.providers?.instagram===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure Instagram OAuth to enable."})]}),!B,U("facebook")&&t.jsxs("section",{className:"rounded-2xl p-4 bg-white/60 backdrop-blur border border-white/70 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Facebook Login"}),t.jsx("div",{className:"text-sm text-slate-600",children:"Grant Page access (required for IG Business data)"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{status:j("facebook")?"connected":c.providers_live?.facebook?"configured":"pending",warn:f("facebook")}),t.jsxs("label",{className:"inline-flex items-center gap-1 text-[11px]",children:[t.jsx("span",{className:`${c.providers_live?.facebook?"text-emerald-700":"text-slate-600"}`,children:c.providers_live?.facebook?"Live":"Demo"}),t.jsx("input",{type:"checkbox",checked:!!c.providers_live?.facebook,onChange:e=>q("facebook",e.target.checked)})]})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:[t.jsx(n,{variant:"outline",disabled:o||g.facebook||d?.providers?.facebook===!1,onClick:()=>S("facebook"),children:g.facebook?"Connecting…":N("facebook")}),t.jsx(n,{variant:"outline",disabled:o,onClick:()=>C("facebook"),children:y.ctas.secondary.refresh}),v?.facebook?.last_sync&&t.jsxs("span",{className:"text-[11px] text-slate-600",children:["Last sync: ",$(v.facebook.last_sync)]}),f("facebook")&&t.jsx("span",{className:"text-[11px] text-amber-700",children:"Token expiring soon"})]}),d?.providers?.facebook===!1&&t.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"Pending app credentials — configure Facebook Login to enable."})]})]}),(()=>{try{if(!new URLSearchParams(window.location.search).has("dev"))return null}catch{return null}return t.jsxs("div",{className:"mt-3 rounded-md border bg-slate-50 px-2 py-2 text-xs flex gap-2",children:[t.jsx(n,{variant:"outline",size:"sm",disabled:o,onClick:Ne,children:"RLS self-check"}),t.jsx(n,{variant:"outline",size:"sm",disabled:o,onClick:Se,children:"Cleanup connectors"})]})})(),t.jsx("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:!1}),(()=>{try{if(!new URLSearchParams(window.location.search).has("dev"))return null}catch{return null}const e=15,s="__intg_page",a=Math.max(1,Number(window[s]||1)),p=b=>{window[s]=Math.max(1,b);const R=new Event("int:pg");window.dispatchEvent(R)};return t.jsxs("section",{className:"rounded-2xl p-3 bg-white/60 backdrop-blur border border-white/70 shadow-sm mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-slate-900",children:"Integration events"}),t.jsx(n,{variant:"outline",size:"sm",disabled:o,onClick:Z,children:"Refresh"})]}),t.jsxs("div",{className:"mt-2 text-[12px] max-h-48 overflow-auto",children:[P.slice((a-1)*e,a*e).map((b,R)=>t.jsxs("div",{className:"py-1 border-b border-slate-100/70",children:[t.jsx("div",{className:"text-slate-800",children:b.name}),t.jsx("div",{className:"text-slate-500",children:$(b.ts)})]},R)),P.length===0&&t.jsx("div",{className:"text-slate-500",children:"No recent events"})]}),P.length>e&&t.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs mt-2",children:[t.jsx("button",{className:"px-2 py-1 rounded-md border bg-white disabled:opacity-50",onClick:()=>p(Math.max(1,a-1)),disabled:a<=1,children:"← Prev"}),t.jsx("button",{className:"px-2 py-1 rounded-md border bg-white disabled:opacity-50",onClick:()=>p(a*e<P.length?a+1:a),disabled:a*e>=P.length,children:"Next →"})]})]})})(),t.jsx("pre",{className:"whitespace-pre-wrap mt-3 text-sm text-slate-700",children:me})]})}export{Fe as default};
